<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0f0f1e">
  <title>ğŸ± ë¡œë˜ ë¶„ì„ê¸°</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
    
    :root {
      --bg: #0f0f1e;
      --card: #1a1a2e;
      --card2: #252542;
      --primary: #667eea;
      --primary2: #764ba2;
      --text: #ffffff;
      --text2: #888899;
      --success: #51cf66;
      --danger: #ff6b6b;
      --warning: #ffd43b;
    }
    
    html, body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: var(--bg);
      min-height: 100vh;
      color: var(--text);
    }
    
    .app {
      max-width: 500px;
      margin: 0 auto;
      padding: 16px;
      padding-bottom: 80px;
    }
    
    /* í—¤ë” */
    .header {
      text-align: center;
      padding: 20px 0;
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      margin: -16px -16px 16px -16px;
      padding: 24px 16px;
    }
    .header h1 { font-size: 1.5rem; margin-bottom: 4px; }
    .header p { font-size: 12px; opacity: 0.8; }
    
    /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ */
    .bottom-nav {
      position: fixed;
      bottom: 0; left: 0; right: 0;
      background: var(--card);
      display: flex;
      justify-content: space-around;
      padding: 6px 0;
      padding-bottom: max(6px, env(safe-area-inset-bottom));
      border-top: 1px solid rgba(255,255,255,0.1);
      z-index: 100;
    }
    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 6px 8px;
      color: var(--text2);
      font-size: 9px;
      background: none;
      border: none;
      cursor: pointer;
      transition: color 0.2s;
    }
    .nav-item.active { color: var(--primary); }
    .nav-item span { font-size: 18px; margin-bottom: 2px; }
    
    /* ì¹´ë“œ */
    .card {
      background: var(--card);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 12px;
    }
    .card-title {
      font-size: 13px;
      color: var(--text2);
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .card-highlight {
      background: linear-gradient(135deg, rgba(102,126,234,0.15), rgba(118,75,162,0.15));
      border: 1px solid rgba(102,126,234,0.3);
    }
    
    /* ë¡œë˜ ê³µ */
    .balls { display: flex; gap: 6px; justify-content: center; align-items: center; flex-wrap: wrap; }
    .ball {
      width: 42px; height: 42px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
      font-size: 15px;
      color: #fff;
      text-shadow: 0 1px 2px rgba(0,0,0,0.3);
    }
    .ball.sm { width: 32px; height: 32px; font-size: 12px; }
    .ball.xs { width: 26px; height: 26px; font-size: 10px; }
    .ball.b1 { background: linear-gradient(135deg, #ffd700, #f0a500); }
    .ball.b2 { background: linear-gradient(135deg, #4dabf7, #228be6); }
    .ball.b3 { background: linear-gradient(135deg, #ff6b6b, #e03131); }
    .ball.b4 { background: linear-gradient(135deg, #868e96, #495057); }
    .ball.b5 { background: linear-gradient(135deg, #51cf66, #2f9e44); }
    .ball.bonus { box-shadow: 0 0 0 3px var(--bg), 0 0 0 5px var(--primary); }
    .plus { color: var(--text2); font-size: 18px; margin: 0 4px; }
    
    /* ìµœì‹  íšŒì°¨ */
    .latest-round {
      text-align: center;
      font-size: 28px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .latest-date { text-align: center; color: var(--text2); font-size: 13px; margin-bottom: 16px; }
    
    /* ë‹¹ì²¨ê¸ˆ ì •ë³´ */
    .prize-info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin-top: 16px;
    }
    .prize-item {
      background: var(--card2);
      padding: 10px;
      border-radius: 10px;
      text-align: center;
    }
    .prize-item.highlight { grid-column: span 2; background: linear-gradient(135deg, rgba(102,126,234,0.2), rgba(118,75,162,0.2)); }
    .prize-label { font-size: 11px; color: var(--text2); }
    .prize-value { font-size: 15px; font-weight: 700; margin-top: 2px; }
    .prize-sub { font-size: 10px; color: var(--text2); }
    
    /* ë¦¬ìŠ¤íŠ¸ */
    .list-item {
      display: flex;
      align-items: center;
      padding: 10px;
      background: var(--card2);
      border-radius: 10px;
      margin-bottom: 6px;
    }
    .list-round {
      font-weight: 700;
      color: var(--primary);
      font-size: 13px;
      min-width: 55px;
    }
    .list-balls { display: flex; gap: 3px; flex: 1; justify-content: center; }
    .list-date { color: var(--text2); font-size: 10px; min-width: 50px; text-align: right; }
    
    /* ì…ë ¥ */
    .input, .select {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      background: var(--card2);
      color: var(--text);
      font-size: 16px;
      outline: none;
    }
    .input::placeholder { color: var(--text2); }
    .input-group { display: flex; gap: 8px; }
    .input-group .input { flex: 1; }
    
    /* ë²„íŠ¼ */
    .btn {
      width: 100%;
      padding: 14px;
      border: none;
      border-radius: 12px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s, opacity 0.2s;
    }
    .btn:active { transform: scale(0.98); }
    .btn-primary { background: linear-gradient(135deg, var(--primary), var(--primary2)); color: #fff; }
    .btn-success { background: linear-gradient(135deg, #51cf66, #2f9e44); color: #fff; }
    .btn-danger { background: linear-gradient(135deg, #ff6b6b, #e03131); color: #fff; }
    .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
    .btn-sm { padding: 10px 16px; font-size: 13px; width: auto; }
    .btn-group { display: flex; gap: 8px; margin-bottom: 12px; }
    .btn-group .btn { flex: 1; }
    
    /* íƒ­ */
    .tabs { display: flex; gap: 6px; margin-bottom: 16px; overflow-x: auto; }
    .tab {
      padding: 8px 14px;
      border-radius: 20px;
      font-size: 12px;
      white-space: nowrap;
      background: var(--card2);
      color: var(--text2);
      border: none;
      cursor: pointer;
    }
    .tab.active { background: var(--primary); color: #fff; }
    
    /* í†µê³„ ê·¸ë¦¬ë“œ */
    .stat-grid {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 4px;
    }
    .stat-item {
      text-align: center;
      padding: 8px 2px;
      background: var(--card2);
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }
    .stat-item:hover { background: rgba(102,126,234,0.3); }
    .stat-item.selected { background: var(--primary); }
    .stat-item.excluded { background: var(--danger); opacity: 0.7; }
    .stat-item.required { background: var(--success); }
    .stat-num { font-weight: 700; font-size: 13px; }
    .stat-count { font-size: 9px; color: var(--text2); }
    
    /* ë¶„ì„ ê²°ê³¼ ë°•ìŠ¤ */
    .result-box {
      background: var(--card2);
      border-radius: 12px;
      padding: 16px;
      margin-top: 12px;
    }
    .result-title { font-size: 12px; color: var(--text2); margin-bottom: 10px; }
    .result-numbers { margin-bottom: 12px; }
    
    /* í†µê³„ ë°” */
    .stat-bar {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }
    .stat-bar-label { width: 40px; font-size: 12px; color: var(--text2); }
    .stat-bar-track {
      flex: 1;
      height: 20px;
      background: var(--card2);
      border-radius: 10px;
      overflow: hidden;
      margin: 0 8px;
    }
    .stat-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--primary), var(--primary2));
      border-radius: 10px;
      transition: width 0.3s;
    }
    .stat-bar-value { width: 50px; font-size: 12px; text-align: right; }
    
    /* ë¼ë²¨ */
    .label {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
    }
    .label-hot { background: rgba(255,107,107,0.2); color: var(--danger); }
    .label-cold { background: rgba(77,171,247,0.2); color: #4dabf7; }
    .label-info { background: rgba(102,126,234,0.2); color: var(--primary); }
    
    /* í˜ì´ì§€ë„¤ì´ì…˜ */
    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 12px;
      margin-top: 16px;
    }
    .pagination button {
      padding: 10px 16px;
      background: var(--card2);
      border: none;
      border-radius: 8px;
      color: var(--text);
      cursor: pointer;
    }
    .pagination button:disabled { opacity: 0.3; }
    .page-info { font-size: 13px; color: var(--text2); }
    
    /* ì„¹ì…˜ */
    .section { display: none; }
    .section.active { display: block; }
    
    /* ë¡œë”© */
    .loading { text-align: center; padding: 60px 20px; }
    .spinner {
      width: 40px; height: 40px;
      border: 4px solid var(--card2);
      border-top-color: var(--primary);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    /* í…Œì´ë¸” */
    .table {
      width: 100%;
      font-size: 12px;
    }
    .table th, .table td {
      padding: 8px;
      text-align: center;
      border-bottom: 1px solid var(--card2);
    }
    .table th { color: var(--text2); font-weight: 500; }
    
    /* ìˆ«ì ì„ íƒ ê·¸ë¦¬ë“œ */
    .number-grid {
      display: grid;
      grid-template-columns: repeat(9, 1fr);
      gap: 4px;
      margin-bottom: 12px;
    }
    .number-btn {
      aspect-ratio: 1;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
    }
    .number-btn.b1 { background: rgba(255,215,0,0.2); color: #ffd700; }
    .number-btn.b2 { background: rgba(77,171,247,0.2); color: #4dabf7; }
    .number-btn.b3 { background: rgba(255,107,107,0.2); color: #ff6b6b; }
    .number-btn.b4 { background: rgba(134,142,150,0.2); color: #868e96; }
    .number-btn.b5 { background: rgba(81,207,102,0.2); color: #51cf66; }
    .number-btn.excluded { background: var(--danger) !important; color: #fff !important; }
    .number-btn.required { background: var(--success) !important; color: #fff !important; }
    
    /* ì˜ˆì¸¡ ê²°ê³¼ */
    .predict-result {
      background: linear-gradient(135deg, rgba(102,126,234,0.1), rgba(118,75,162,0.1));
      border: 1px solid rgba(102,126,234,0.3);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 8px;
    }
    .predict-index {
      font-size: 11px;
      color: var(--primary);
      margin-bottom: 6px;
    }
    
    /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ */
    .chart-container {
      height: 200px;
      background: var(--card2);
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 12px;
    }
    
    /* ì•Œë¦¼ */
    .alert {
      padding: 12px;
      border-radius: 10px;
      margin-bottom: 12px;
      font-size: 13px;
    }
    .alert-info { background: rgba(102,126,234,0.2); color: var(--primary); }
    .alert-success { background: rgba(81,207,102,0.2); color: var(--success); }
    .alert-danger { background: rgba(255,107,107,0.2); color: var(--danger); }
    
    /* ë²ˆí˜¸ ì²´í¬ ê²°ê³¼ */
    .check-result {
      text-align: center;
      padding: 20px;
    }
    .check-rank {
      font-size: 48px;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .check-prize { font-size: 24px; font-weight: 700; margin: 10px 0; }
    .check-matched { color: var(--text2); font-size: 14px; }
  </style>
</head>
<body>

<div class="app">
  <header class="header">
    <h1>ğŸ± ë¡œë˜ ë¶„ì„ê¸°</h1>
    <p>ë‹¹ì²¨ë²ˆí˜¸ ì¡°íšŒ Â· í†µê³„ ë¶„ì„ Â· AI ì˜ˆì¸¡</p>
  </header>
  
  <!-- ë¡œë”© -->
  <div id="loading" class="loading">
    <div class="spinner"></div>
    <p>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
  </div>
  
  <!-- ğŸ  í™ˆ -->
  <div id="sec-home" class="section">
    <div class="card card-highlight">
      <div class="latest-round" id="latestRound">-</div>
      <div class="latest-date" id="latestDate">-</div>
      <div class="balls" id="latestBalls"></div>
      
      <div class="prize-info">
        <div class="prize-item highlight">
          <div class="prize-label">1ë“± ë‹¹ì²¨ê¸ˆ</div>
          <div class="prize-value" id="prize1">-</div>
          <div class="prize-sub" id="winners1">-</div>
        </div>
        <div class="prize-item">
          <div class="prize-label">2ë“±</div>
          <div class="prize-value" id="prize2">-</div>
        </div>
        <div class="prize-item">
          <div class="prize-label">3ë“±</div>
          <div class="prize-value" id="prize3">-</div>
        </div>
        <div class="prize-item">
          <div class="prize-label">ì´ íŒë§¤ì•¡</div>
          <div class="prize-value" id="totalSales">-</div>
        </div>
        <div class="prize-item">
          <div class="prize-label">ì´ ë‹¹ì²¨ì</div>
          <div class="prize-value" id="totalWinners">-</div>
        </div>
      </div>
    </div>
    
    <div class="card">
      <div class="card-title">ğŸ“‹ ìµœê·¼ ë‹¹ì²¨ë²ˆí˜¸</div>
      <div id="recentList"></div>
    </div>
  </div>
  
  <!-- ğŸ” ê²€ìƒ‰ -->
  <div id="sec-search" class="section">
    <div class="card">
      <div class="card-title">ğŸ” íšŒì°¨ ê²€ìƒ‰</div>
      <div class="input-group">
        <input type="number" id="searchInput" class="input" placeholder="íšŒì°¨ ë²ˆí˜¸ ì…ë ¥" inputmode="numeric">
        <button class="btn btn-primary btn-sm" onclick="searchRound()">ê²€ìƒ‰</button>
      </div>
    </div>
    <div id="searchResult"></div>
    
    <div class="card">
      <div class="card-title">ğŸ« ë‚´ ë²ˆí˜¸ ë‹¹ì²¨ í™•ì¸</div>
      <p style="font-size:12px;color:var(--text2);margin-bottom:12px;">ë²ˆí˜¸ 6ê°œë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
      <div class="number-grid" id="checkGrid"></div>
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;">
        <span style="font-size:12px;color:var(--text2);">ì„ íƒí•œ ë²ˆí˜¸:</span>
        <div class="balls" id="selectedBalls" style="flex:1;justify-content:flex-start;"></div>
        <button class="btn btn-outline btn-sm" onclick="clearCheck()" style="width:auto;">ì´ˆê¸°í™”</button>
      </div>
      <div class="input-group" style="margin-bottom:12px;">
        <input type="number" id="checkRound" class="input" placeholder="í™•ì¸í•  íšŒì°¨ (ë¹ˆì¹¸=ìµœì‹ )" inputmode="numeric">
        <button class="btn btn-success btn-sm" onclick="checkMyNumbers()">í™•ì¸</button>
      </div>
      <div id="checkResult"></div>
    </div>
  </div>
  
  <!-- ğŸ“œ ê¸°ë¡ -->
  <div id="sec-history" class="section">
    <div class="card">
      <div class="card-title">ğŸ“œ ì „ì²´ ë‹¹ì²¨ ê¸°ë¡</div>
      <div id="historyList"></div>
      <div class="pagination">
        <button onclick="prevPage()">â—€ ì´ì „</button>
        <span class="page-info" id="pageInfo">1/1</span>
        <button onclick="nextPage()">ë‹¤ìŒ â–¶</button>
      </div>
    </div>
  </div>
  
  <!-- ğŸ“Š í†µê³„ -->
  <div id="sec-stats" class="section">
    <div class="tabs" id="statTabs">
      <button class="tab active" onclick="showStatTab('freq',this)">ì¶œí˜„ë¹ˆë„</button>
      <button class="tab" onclick="showStatTab('pattern',this)">íŒ¨í„´ë¶„ì„</button>
      <button class="tab" onclick="showStatTab('advanced',this)">ê³ ê¸‰í†µê³„</button>
      <button class="tab" onclick="showStatTab('prize',this)">ë‹¹ì²¨ê¸ˆ</button>
    </div>
    
    <!-- ì¶œí˜„ë¹ˆë„ -->
    <div id="stat-freq" class="stat-content">
      <div class="card">
        <div class="card-title">ğŸ”¥ HOT ë²ˆí˜¸ <span class="label label-hot">ìì£¼ ì¶œí˜„</span></div>
        <div class="balls" id="hotNumbers"></div>
      </div>
      <div class="card">
        <div class="card-title">â„ï¸ COLD ë²ˆí˜¸ <span class="label label-cold">ì ê²Œ ì¶œí˜„</span></div>
        <div class="balls" id="coldNumbers"></div>
      </div>
      <div class="card">
        <div class="card-title">â° ì˜¤ë˜ ì•ˆ ë‚˜ì˜¨ ë²ˆí˜¸</div>
        <div class="balls" id="longAbsent"></div>
        <p style="font-size:11px;color:var(--text2);text-align:center;margin-top:8px;">ë¯¸ì¶œí˜„ ê¸°ê°„ì´ ê¸´ ë²ˆí˜¸</p>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“Š ë²ˆí˜¸ë³„ ì¶œí˜„ íšŸìˆ˜</div>
        <div class="stat-grid" id="freqGrid"></div>
      </div>
    </div>
    
    <!-- íŒ¨í„´ë¶„ì„ -->
    <div id="stat-pattern" class="stat-content" style="display:none;">
      <div class="card">
        <div class="card-title">âš–ï¸ í™€ì§ ë¹„ìœ¨</div>
        <div id="oddEvenStats"></div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“ ê³ ì € ë¹„ìœ¨ (1-22 vs 23-45)</div>
        <div id="highLowStats"></div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ¯ ë²ˆí˜¸ëŒ€ë³„ ë¶„í¬</div>
        <div id="rangeStats"></div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ”¢ ëìˆ˜ ë¶„í¬ (0~9)</div>
        <div id="endNumStats"></div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“ˆ ì´í•© ë¶„í¬</div>
        <div id="sumStats"></div>
        <p style="font-size:11px;color:var(--text2);margin-top:8px;">6ê°œ ë²ˆí˜¸ í•©ê³„ í‰ê· : <span id="avgSum">-</span></p>
      </div>
      <div class="card">
        <div class="card-title">ğŸ”— ì—°ì†ë²ˆí˜¸ ì¶œí˜„</div>
        <div id="consecutiveStats"></div>
      </div>
    </div>
    
    <!-- ê³ ê¸‰í†µê³„ -->
    <div id="stat-advanced" class="stat-content" style="display:none;">
      <div class="card">
        <div class="card-title">ğŸ“ ê¸°ë³¸ í†µê³„ëŸ‰</div>
        <table class="table">
          <tr><th>í•­ëª©</th><th>ê°’</th></tr>
          <tr><td>í‰ê· </td><td id="statMean">-</td></tr>
          <tr><td>ì¤‘ì•™ê°’</td><td id="statMedian">-</td></tr>
          <tr><td>í‘œì¤€í¸ì°¨</td><td id="statStd">-</td></tr>
          <tr><td>ë¶„ì‚°</td><td id="statVar">-</td></tr>
        </table>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“Š ì‚¬ë¶„ìœ„ìˆ˜</div>
        <table class="table">
          <tr><th>Q1 (25%)</th><th>Q2 (ì¤‘ì•™)</th><th>Q3 (75%)</th><th>IQR</th></tr>
          <tr>
            <td id="statQ1">-</td>
            <td id="statQ2">-</td>
            <td id="statQ3">-</td>
            <td id="statIQR">-</td>
          </tr>
        </table>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“ˆ Z-Score ë¶„ì„</div>
        <p style="font-size:11px;color:var(--text2);margin-bottom:12px;">í‰ê·  ëŒ€ë¹„ ì¶œí˜„ ë¹ˆë„ í¸ì°¨ (|Z|>1.5: ì£¼ëª©)</p>
        <div id="zscoreGrid"></div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ² ACê°’ ë¶„ì„</div>
        <p style="font-size:11px;color:var(--text2);margin-bottom:8px;">ë²ˆí˜¸ ì¡°í•©ì˜ ë³µì¡ë„ (ë†’ì„ìˆ˜ë¡ ë¶„ì‚°ë¨)</p>
        <div id="acStats"></div>
      </div>
    </div>
    
    <!-- ë‹¹ì²¨ê¸ˆ -->
    <div id="stat-prize" class="stat-content" style="display:none;">
      <div class="card">
        <div class="card-title">ğŸ’° ë“±ìˆ˜ë³„ í‰ê·  ë‹¹ì²¨ê¸ˆ</div>
        <table class="table">
          <tr><th>ë“±ìˆ˜</th><th>í‰ê·  ë‹¹ì²¨ê¸ˆ</th><th>í‰ê·  ë‹¹ì²¨ì</th></tr>
          <tr><td>1ë“±</td><td id="avgPrize1">-</td><td id="avgWinners1">-</td></tr>
          <tr><td>2ë“±</td><td id="avgPrize2">-</td><td id="avgWinners2">-</td></tr>
          <tr><td>3ë“±</td><td id="avgPrize3">-</td><td id="avgWinners3">-</td></tr>
          <tr><td>4ë“±</td><td id="avgPrize4">-</td><td id="avgWinners4">-</td></tr>
          <tr><td>5ë“±</td><td id="avgPrize5">-</td><td id="avgWinners5">-</td></tr>
        </table>
      </div>
      <div class="card">
        <div class="card-title">ğŸ“ˆ ìµœê·¼ 1ë“± ë‹¹ì²¨ê¸ˆ ì¶”ì´</div>
        <div id="prizeTrend"></div>
      </div>
      <div class="card">
        <div class="card-title">ğŸ† ì—­ëŒ€ ìµœê³  ë‹¹ì²¨ê¸ˆ</div>
        <div id="maxPrize"></div>
      </div>
    </div>
  </div>
  
  <!-- ğŸ”® ì˜ˆì¸¡ -->
  <div id="sec-predict" class="section">
    <div class="card">
      <div class="card-title">âš™ï¸ ì˜ˆì¸¡ ì„¤ì •</div>
      
      <div style="margin-bottom:16px;">
        <label style="font-size:12px;color:var(--text2);display:block;margin-bottom:8px;">ğŸ“Š ì „ëµ ì„ íƒ</label>
        <select id="predictStrategy" class="input" style="padding:12px;">
          <option value="balanced">ê· í˜• ì „ëµ (ë¹ˆë„ + ë¯¸ì¶œí˜„)</option>
          <option value="hot">HOT ì „ëµ (ìì£¼ ë‚˜ì˜¨ ë²ˆí˜¸)</option>
          <option value="cold">COLD ì „ëµ (ì•ˆ ë‚˜ì˜¨ ë²ˆí˜¸)</option>
          <option value="pattern">íŒ¨í„´ ì „ëµ (í™€ì§/ê³ ì € ê· í˜•)</option>
          <option value="zscore">Z-Score ì „ëµ (í†µê³„ì  ì´ìƒì¹˜)</option>
          <option value="trend">íŠ¸ë Œë“œ ì „ëµ (ìµœê·¼ 10íšŒ ê°€ì¤‘)</option>
          <option value="random">ì™„ì „ ëœë¤</option>
        </select>
      </div>
      
      <div style="margin-bottom:16px;">
        <label style="font-size:12px;color:var(--text2);display:block;margin-bottom:8px;">ğŸš« ì œì™¸ ë²ˆí˜¸ (í„°ì¹˜ë¡œ ì„ íƒ)</label>
        <div class="number-grid" id="excludeGrid"></div>
      </div>
      
      <div style="margin-bottom:16px;">
        <label style="font-size:12px;color:var(--text2);display:block;margin-bottom:8px;">â­ í•„ìˆ˜ ë²ˆí˜¸ (ìµœëŒ€ 5ê°œ)</label>
        <div class="number-grid" id="requireGrid"></div>
      </div>
      
      <div style="margin-bottom:16px;">
        <label style="font-size:12px;color:var(--text2);display:block;margin-bottom:8px;">ğŸ”¢ ìƒì„± ê°œìˆ˜</label>
        <div style="display:flex;align-items:center;gap:12px;">
          <button class="btn btn-outline btn-sm" onclick="adjustCount(-1)">âˆ’</button>
          <span id="predictCount" style="font-size:20px;font-weight:700;min-width:40px;text-align:center;">5</span>
          <button class="btn btn-outline btn-sm" onclick="adjustCount(1)">+</button>
          <span style="font-size:12px;color:var(--text2);">ì„¸íŠ¸</span>
        </div>
      </div>
      
      <button class="btn btn-primary" onclick="generatePrediction()">âœ¨ ë²ˆí˜¸ ìƒì„±í•˜ê¸°</button>
    </div>
    
    <div id="predictResults"></div>
  </div>
  
  <!-- âš™ï¸ ì„¤ì • -->
  <div id="sec-settings" class="section">
    <div class="card">
      <div class="card-title">ğŸ“Š ë°ì´í„° í˜„í™©</div>
      <div id="dataStatus"></div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”„ ë°ì´í„° ê´€ë¦¬</div>
      <button class="btn btn-outline" onclick="refreshData()" style="margin-bottom:8px;">ğŸ”„ ë°ì´í„° ìƒˆë¡œê³ ì¹¨</button>
      <button class="btn btn-outline" onclick="exportData()" style="margin-bottom:8px;">ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
      <button class="btn btn-danger" onclick="clearCache()">ğŸ—‘ï¸ ìºì‹œ ì‚­ì œ</button>
    </div>
    <div class="card">
      <div class="card-title">â„¹ï¸ ì •ë³´</div>
      <p style="font-size:12px;color:var(--text2);line-height:1.6;">
        ì´ ì•±ì€ ë¡œë˜ ë‹¹ì²¨ë²ˆí˜¸ë¥¼ ë¶„ì„í•˜ê³  í†µê³„ ê¸°ë°˜ ì˜ˆì¸¡ì„ ì œê³µí•©ë‹ˆë‹¤.<br><br>
        âš ï¸ ë¡œë˜ëŠ” ì™„ì „í•œ ë¬´ì‘ìœ„ ì¶”ì²¨ì…ë‹ˆë‹¤. í†µê³„ ë¶„ì„ì€ ì°¸ê³ ìš©ì´ë©°, ë‹¹ì²¨ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
      </p>
    </div>
  </div>
</div>

<!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
<nav class="bottom-nav">
  <button class="nav-item active" onclick="showSection('home',this)"><span>ğŸ </span>í™ˆ</button>
  <button class="nav-item" onclick="showSection('search',this)"><span>ğŸ”</span>ê²€ìƒ‰</button>
  <button class="nav-item" onclick="showSection('history',this)"><span>ğŸ“œ</span>ê¸°ë¡</button>
  <button class="nav-item" onclick="showSection('stats',this)"><span>ğŸ“Š</span>í†µê³„</button>
  <button class="nav-item" onclick="showSection('predict',this)"><span>ğŸ”®</span>ì˜ˆì¸¡</button>
  <button class="nav-item" onclick="showSection('settings',this)"><span>âš™ï¸</span>ì„¤ì •</button>
</nav>

<script>
// ì „ì—­ ë³€ìˆ˜
let lottoData = [];
let currentPage = 1;
const perPage = 15;
let excludedNumbers = new Set();
let requiredNumbers = new Set();
let checkNumbers = new Set();
let predictCount = 5;

// ì´ˆê¸°í™”
async function init() {
  try {
    const res = await fetch('lotto_data.json');
    if (!res.ok) throw new Error('ë°ì´í„° íŒŒì¼ ì—†ìŒ');
    lottoData = await res.json();
    lottoData.sort((a, b) => b.round - a.round);
    
    document.getElementById('loading').style.display = 'none';
    document.getElementById('sec-home').classList.add('active');
    
    renderHome();
    renderStats();
    initNumberGrids();
    updateDataStatus();
  } catch (e) {
    document.getElementById('loading').innerHTML = `
      <p style="color:var(--danger);">âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</p>
      <p style="font-size:12px;color:var(--text2);margin-top:8px;">${e.message}</p>
      <button class="btn btn-primary" style="margin-top:16px;" onclick="location.reload()">ë‹¤ì‹œ ì‹œë„</button>
    `;
  }
}

// ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
function getBallClass(n) {
  if (n <= 10) return 'b1';
  if (n <= 20) return 'b2';
  if (n <= 30) return 'b3';
  if (n <= 40) return 'b4';
  return 'b5';
}

function createBall(n, size = '', bonus = false) {
  return `<div class="ball ${size} ${getBallClass(n)} ${bonus ? 'bonus' : ''}">${n}</div>`;
}

function createBalls(nums, bonus = null, size = 'sm') {
  let html = nums.map(n => createBall(n, size)).join('');
  if (bonus) html += `<span class="plus">+</span>${createBall(bonus, size, true)}`;
  return html;
}

function formatMoney(amount) {
  if (!amount) return '-';
  if (amount >= 100000000) return (amount / 100000000).toFixed(1) + 'ì–µ';
  if (amount >= 10000) return (amount / 10000).toFixed(0) + 'ë§Œ';
  return amount.toLocaleString();
}

function formatDate(dateStr) {
  if (!dateStr || dateStr.length !== 8) return dateStr;
  return `${dateStr.slice(0,4)}.${dateStr.slice(4,6)}.${dateStr.slice(6,8)}`;
}

// ì„¹ì…˜ ì „í™˜
function showSection(id, el) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('sec-' + id).classList.add('active');
  
  if (id === 'history') renderHistory();
  if (id === 'stats') renderStats();
  if (id === 'settings') updateDataStatus();
  
  window.scrollTo(0, 0);
}

// í™ˆ ë Œë”ë§
function renderHome() {
  if (!lottoData.length) return;
  
  const latest = lottoData[0];
  document.getElementById('latestRound').textContent = `${latest.round}íšŒ`;
  document.getElementById('latestDate').textContent = formatDate(latest.date);
  document.getElementById('latestBalls').innerHTML = createBalls(latest.numbers, latest.bonus, '');
  
  document.getElementById('prize1').textContent = formatMoney(latest.rank1?.prize) + 'ì›';
  document.getElementById('winners1').textContent = `${latest.rank1?.winners || 0}ëª… ë‹¹ì²¨`;
  document.getElementById('prize2').textContent = formatMoney(latest.rank2?.prize) + 'ì›';
  document.getElementById('prize3').textContent = formatMoney(latest.rank3?.prize) + 'ì›';
  document.getElementById('totalSales').textContent = formatMoney(latest.totalSales) + 'ì›';
  document.getElementById('totalWinners').textContent = (latest.totalWinners || 0).toLocaleString() + 'ëª…';
  
  document.getElementById('recentList').innerHTML = lottoData.slice(0, 5).map(item => `
    <div class="list-item">
      <span class="list-round">${item.round}íšŒ</span>
      <div class="list-balls">${createBalls(item.numbers, item.bonus, 'xs')}</div>
      <span class="list-date">${formatDate(item.date).slice(5)}</span>
    </div>
  `).join('');
}

// ê²€ìƒ‰
function searchRound() {
  const round = parseInt(document.getElementById('searchInput').value);
  const item = lottoData.find(d => d.round === round);
  
  if (item) {
    document.getElementById('searchResult').innerHTML = `
      <div class="card card-highlight">
        <div class="latest-round">${item.round}íšŒ</div>
        <div class="latest-date">${formatDate(item.date)}</div>
        <div class="balls">${createBalls(item.numbers, item.bonus)}</div>
        <div class="prize-info">
          <div class="prize-item highlight">
            <div class="prize-label">1ë“±</div>
            <div class="prize-value">${formatMoney(item.rank1?.prize)}ì›</div>
            <div class="prize-sub">${item.rank1?.winners || 0}ëª…</div>
          </div>
          <div class="prize-item">
            <div class="prize-label">2ë“±</div>
            <div class="prize-value">${formatMoney(item.rank2?.prize)}ì›</div>
          </div>
          <div class="prize-item">
            <div class="prize-label">3ë“±</div>
            <div class="prize-value">${formatMoney(item.rank3?.prize)}ì›</div>
          </div>
        </div>
      </div>
    `;
  } else {
    document.getElementById('searchResult').innerHTML = `
      <div class="alert alert-danger">í•´ë‹¹ íšŒì°¨ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>
    `;
  }
}

// ê¸°ë¡
function renderHistory() {
  const start = (currentPage - 1) * perPage;
  const items = lottoData.slice(start, start + perPage);
  
  document.getElementById('historyList').innerHTML = items.map(item => `
    <div class="list-item">
      <span class="list-round">${item.round}íšŒ</span>
      <div class="list-balls">${createBalls(item.numbers, item.bonus, 'xs')}</div>
      <span class="list-date">${formatDate(item.date).slice(5)}</span>
    </div>
  `).join('');
  
  const totalPages = Math.ceil(lottoData.length / perPage);
  document.getElementById('pageInfo').textContent = `${currentPage} / ${totalPages}`;
}

function prevPage() {
  if (currentPage > 1) { currentPage--; renderHistory(); }
}
function nextPage() {
  if (currentPage < Math.ceil(lottoData.length / perPage)) { currentPage++; renderHistory(); }
}

// í†µê³„ íƒ­
function showStatTab(id, el) {
  document.querySelectorAll('#statTabs .tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.stat-content').forEach(c => c.style.display = 'none');
  el.classList.add('active');
  document.getElementById('stat-' + id).style.display = 'block';
}

// í†µê³„ ë Œë”ë§
function renderStats() {
  if (!lottoData.length) return;
  
  // ë¹ˆë„ ê³„ì‚°
  const freq = {};
  const lastSeen = {};
  for (let i = 1; i <= 45; i++) { freq[i] = 0; lastSeen[i] = 9999; }
  
  lottoData.forEach((item, idx) => {
    item.numbers.forEach(n => {
      freq[n]++;
      if (idx < lastSeen[n]) lastSeen[n] = idx;
    });
  });
  
  const sorted = Object.entries(freq).sort((a, b) => b[1] - a[1]);
  const sortedByAbsent = Object.entries(lastSeen).sort((a, b) => b[1] - a[1]);
  
  // HOT/COLD
  document.getElementById('hotNumbers').innerHTML = sorted.slice(0, 6).map(([n]) => createBall(+n, 'sm')).join('');
  document.getElementById('coldNumbers').innerHTML = sorted.slice(-6).reverse().map(([n]) => createBall(+n, 'sm')).join('');
  document.getElementById('longAbsent').innerHTML = sortedByAbsent.slice(0, 6).map(([n]) => createBall(+n, 'sm')).join('');
  
  // ë¹ˆë„ ê·¸ë¦¬ë“œ
  const maxFreq = Math.max(...Object.values(freq));
  document.getElementById('freqGrid').innerHTML = Object.entries(freq).map(([n, c]) => `
    <div class="stat-item" style="background:rgba(102,126,234,${c/maxFreq*0.5 + 0.1});">
      <div class="stat-num" style="color:${getBallColorText(+n)}">${n}</div>
      <div class="stat-count">${c}íšŒ</div>
    </div>
  `).join('');
  
  // íŒ¨í„´ ë¶„ì„
  renderPatternStats();
  
  // ê³ ê¸‰ í†µê³„
  renderAdvancedStats(freq);
  
  // ë‹¹ì²¨ê¸ˆ í†µê³„
  renderPrizeStats();
}

function getBallColorText(n) {
  if (n <= 10) return '#ffd700';
  if (n <= 20) return '#4dabf7';
  if (n <= 30) return '#ff6b6b';
  if (n <= 40) return '#868e96';
  return '#51cf66';
}

function renderPatternStats() {
  // í™€ì§
  const oddEven = { odd: [0,0,0,0,0,0,0], even: [0,0,0,0,0,0,0] };
  // ê³ ì €
  const highLow = { low: [0,0,0,0,0,0,0], high: [0,0,0,0,0,0,0] };
  // ë²ˆí˜¸ëŒ€
  const ranges = { '1-10': 0, '11-20': 0, '21-30': 0, '31-40': 0, '41-45': 0 };
  // ëìˆ˜
  const endNums = {};
  for (let i = 0; i <= 9; i++) endNums[i] = 0;
  // ì´í•©
  const sums = [];
  // ì—°ì†ë²ˆí˜¸
  let consecutiveCount = 0;
  
  lottoData.forEach(item => {
    const nums = item.numbers;
    const oddCount = nums.filter(n => n % 2 === 1).length;
    const lowCount = nums.filter(n => n <= 22).length;
    
    oddEven.odd[oddCount]++;
    oddEven.even[6 - oddCount]++;
    highLow.low[lowCount]++;
    highLow.high[6 - lowCount]++;
    
    nums.forEach(n => {
      if (n <= 10) ranges['1-10']++;
      else if (n <= 20) ranges['11-20']++;
      else if (n <= 30) ranges['21-30']++;
      else if (n <= 40) ranges['31-40']++;
      else ranges['41-45']++;
      
      endNums[n % 10]++;
    });
    
    sums.push(nums.reduce((a, b) => a + b, 0));
    
    // ì—°ì†ë²ˆí˜¸ ì²´í¬
    const sorted = [...nums].sort((a, b) => a - b);
    for (let i = 0; i < sorted.length - 1; i++) {
      if (sorted[i + 1] - sorted[i] === 1) consecutiveCount++;
    }
  });
  
  // í™€ì§ ë Œë”ë§
  const maxOddEven = Math.max(...oddEven.odd);
  document.getElementById('oddEvenStats').innerHTML = oddEven.odd.map((v, i) => `
    <div class="stat-bar">
      <span class="stat-bar-label">${i}:${6-i}</span>
      <div class="stat-bar-track"><div class="stat-bar-fill" style="width:${v/maxOddEven*100}%"></div></div>
      <span class="stat-bar-value">${v}íšŒ</span>
    </div>
  `).join('');
  
  // ê³ ì € ë Œë”ë§
  const maxHL = Math.max(...highLow.low);
  document.getElementById('highLowStats').innerHTML = highLow.low.map((v, i) => `
    <div class="stat-bar">
      <span class="stat-bar-label">${i}:${6-i}</span>
      <div class="stat-bar-track"><div class="stat-bar-fill" style="width:${v/maxHL*100}%"></div></div>
      <span class="stat-bar-value">${v}íšŒ</span>
    </div>
  `).join('');
  
  // ë²ˆí˜¸ëŒ€ ë Œë”ë§
  const maxRange = Math.max(...Object.values(ranges));
  document.getElementById('rangeStats').innerHTML = Object.entries(ranges).map(([k, v]) => `
    <div class="stat-bar">
      <span class="stat-bar-label">${k}</span>
      <div class="stat-bar-track"><div class="stat-bar-fill" style="width:${v/maxRange*100}%"></div></div>
      <span class="stat-bar-value">${v}</span>
    </div>
  `).join('');
  
  // ëìˆ˜ ë Œë”ë§
  const maxEnd = Math.max(...Object.values(endNums));
  document.getElementById('endNumStats').innerHTML = Object.entries(endNums).map(([k, v]) => `
    <div class="stat-bar">
      <span class="stat-bar-label">${k}</span>
      <div class="stat-bar-track"><div class="stat-bar-fill" style="width:${v/maxEnd*100}%"></div></div>
      <span class="stat-bar-value">${v}</span>
    </div>
  `).join('');
  
  // ì´í•©
  const avgSum = (sums.reduce((a, b) => a + b, 0) / sums.length).toFixed(1);
  const minSum = Math.min(...sums);
  const maxSum = Math.max(...sums);
  document.getElementById('sumStats').innerHTML = `
    <div style="display:flex;justify-content:space-between;font-size:13px;">
      <span>ìµœì†Œ: ${minSum}</span>
      <span>ìµœëŒ€: ${maxSum}</span>
    </div>
    <div class="stat-bar" style="margin-top:8px;">
      <div class="stat-bar-track" style="position:relative;">
        <div class="stat-bar-fill" style="width:${(avgSum-minSum)/(maxSum-minSum)*100}%"></div>
      </div>
    </div>
  `;
  document.getElementById('avgSum').textContent = avgSum;
  
  // ì—°ì†ë²ˆí˜¸
  document.getElementById('consecutiveStats').innerHTML = `
    <p style="font-size:14px;">ì´ <strong>${consecutiveCount}</strong>ìŒ ì¶œí˜„ (í‰ê·  ${(consecutiveCount/lottoData.length).toFixed(2)}ìŒ/íšŒì°¨)</p>
  `;
}

function renderAdvancedStats(freq) {
  const values = Object.values(freq);
  const n = values.length;
  
  // í‰ê· 
  const mean = values.reduce((a, b) => a + b, 0) / n;
  
  // í‘œì¤€í¸ì°¨
  const variance = values.reduce((sum, v) => sum + Math.pow(v - mean, 2), 0) / n;
  const std = Math.sqrt(variance);
  
  // ì‚¬ë¶„ìœ„ìˆ˜
  const sorted = [...values].sort((a, b) => a - b);
  const q1 = sorted[Math.floor(n * 0.25)];
  const q2 = sorted[Math.floor(n * 0.5)];
  const q3 = sorted[Math.floor(n * 0.75)];
  const iqr = q3 - q1;
  
  document.getElementById('statMean').textContent = mean.toFixed(2);
  document.getElementById('statMedian').textContent = q2;
  document.getElementById('statStd').textContent = std.toFixed(2);
  document.getElementById('statVar').textContent = variance.toFixed(2);
  document.getElementById('statQ1').textContent = q1;
  document.getElementById('statQ2').textContent = q2;
  document.getElementById('statQ3').textContent = q3;
  document.getElementById('statIQR').textContent = iqr;
  
  // Z-Score
  const zscores = {};
  for (let i = 1; i <= 45; i++) {
    zscores[i] = ((freq[i] - mean) / std).toFixed(2);
  }
  
  document.getElementById('zscoreGrid').innerHTML = Object.entries(zscores).map(([n, z]) => {
    const absZ = Math.abs(z);
    let bg = 'var(--card2)';
    if (absZ > 2) bg = z > 0 ? 'rgba(255,107,107,0.4)' : 'rgba(77,171,247,0.4)';
    else if (absZ > 1.5) bg = z > 0 ? 'rgba(255,107,107,0.2)' : 'rgba(77,171,247,0.2)';
    
    return `
      <div class="stat-item" style="background:${bg};">
        <div class="stat-num" style="color:${getBallColorText(+n)}">${n}</div>
        <div class="stat-count">${z}</div>
      </div>
    `;
  }).join('');
  
  // ACê°’ ë¶„ì„
  let acSum = 0;
  lottoData.slice(0, 100).forEach(item => {
    const nums = [...item.numbers].sort((a, b) => a - b);
    const diffs = new Set();
    for (let i = 0; i < nums.length; i++) {
      for (let j = i + 1; j < nums.length; j++) {
        diffs.add(nums[j] - nums[i]);
      }
    }
    acSum += diffs.size - 5;
  });
  const avgAC = (acSum / Math.min(100, lottoData.length)).toFixed(2);
  
  document.getElementById('acStats').innerHTML = `
    <p style="font-size:14px;">ìµœê·¼ 100íšŒ í‰ê·  ACê°’: <strong>${avgAC}</strong></p>
    <p style="font-size:11px;color:var(--text2);margin-top:4px;">ACê°’ ë²”ìœ„: 0~10 (ë³´í†µ 7~10)</p>
  `;
}

function renderPrizeStats() {
  const validData = lottoData.filter(d => d.rank1?.prize > 0);
  
  if (validData.length === 0) {
    document.getElementById('avgPrize1').textContent = '-';
    return;
  }
  
  // í‰ê·  ê³„ì‚°
  for (let i = 1; i <= 5; i++) {
    const prizes = validData.map(d => d[`rank${i}`]?.prize || 0).filter(p => p > 0);
    const winners = validData.map(d => d[`rank${i}`]?.winners || 0);
    
    const avgPrize = prizes.length ? prizes.reduce((a, b) => a + b, 0) / prizes.length : 0;
    const avgWinner = winners.reduce((a, b) => a + b, 0) / winners.length;
    
    document.getElementById(`avgPrize${i}`).textContent = formatMoney(avgPrize) + 'ì›';
    document.getElementById(`avgWinners${i}`).textContent = avgWinner.toFixed(0) + 'ëª…';
  }
  
  // ìµœê·¼ ì¶”ì´
  const recent = validData.slice(0, 10).reverse();
  const maxPrizeVal = Math.max(...recent.map(d => d.rank1?.prize || 0));
  document.getElementById('prizeTrend').innerHTML = recent.map(d => `
    <div class="stat-bar">
      <span class="stat-bar-label">${d.round}</span>
      <div class="stat-bar-track"><div class="stat-bar-fill" style="width:${(d.rank1?.prize||0)/maxPrizeVal*100}%"></div></div>
      <span class="stat-bar-value">${formatMoney(d.rank1?.prize)}</span>
    </div>
  `).join('');
  
  // ì—­ëŒ€ ìµœê³ 
  const maxItem = validData.reduce((max, d) => (d.rank1?.prize || 0) > (max.rank1?.prize || 0) ? d : max);
  document.getElementById('maxPrize').innerHTML = `
    <div style="text-align:center;">
      <div style="font-size:24px;font-weight:700;color:var(--warning);">${formatMoney(maxItem.rank1?.prize)}ì›</div>
      <div style="font-size:13px;color:var(--text2);margin-top:4px;">${maxItem.round}íšŒ (${formatDate(maxItem.date)})</div>
    </div>
  `;
}

// ë²ˆí˜¸ ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
function initNumberGrids() {
  const grids = ['excludeGrid', 'requireGrid', 'checkGrid'];
  
  grids.forEach(gridId => {
    const grid = document.getElementById(gridId);
    grid.innerHTML = '';
    
    for (let i = 1; i <= 45; i++) {
      const btn = document.createElement('button');
      btn.className = `number-btn ${getBallClass(i)}`;
      btn.textContent = i;
      btn.onclick = () => toggleNumber(gridId, i, btn);
      grid.appendChild(btn);
    }
  });
}

function toggleNumber(gridId, num, btn) {
  if (gridId === 'excludeGrid') {
    if (excludedNumbers.has(num)) {
      excludedNumbers.delete(num);
      btn.classList.remove('excluded');
    } else {
      excludedNumbers.add(num);
      requiredNumbers.delete(num);
      btn.classList.add('excluded');
      // í•„ìˆ˜ì—ì„œ ì œê±°
      document.querySelectorAll('#requireGrid .number-btn')[num-1].classList.remove('required');
    }
  } else if (gridId === 'requireGrid') {
    if (requiredNumbers.has(num)) {
      requiredNumbers.delete(num);
      btn.classList.remove('required');
    } else if (requiredNumbers.size < 5 && !excludedNumbers.has(num)) {
      requiredNumbers.add(num);
      btn.classList.add('required');
    }
  } else if (gridId === 'checkGrid') {
    if (checkNumbers.has(num)) {
      checkNumbers.delete(num);
      btn.classList.remove('required');
    } else if (checkNumbers.size < 6) {
      checkNumbers.add(num);
      btn.classList.add('required');
    }
    updateSelectedBalls();
  }
}

function updateSelectedBalls() {
  const container = document.getElementById('selectedBalls');
  const nums = [...checkNumbers].sort((a, b) => a - b);
  container.innerHTML = nums.map(n => createBall(n, 'xs')).join('');
}

function clearCheck() {
  checkNumbers.clear();
  document.querySelectorAll('#checkGrid .number-btn').forEach(btn => btn.classList.remove('required'));
  updateSelectedBalls();
  document.getElementById('checkResult').innerHTML = '';
}

// ë‚´ ë²ˆí˜¸ ë‹¹ì²¨ í™•ì¸
function checkMyNumbers() {
  if (checkNumbers.size !== 6) {
    document.getElementById('checkResult').innerHTML = `<div class="alert alert-danger">6ê°œ ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>`;
    return;
  }
  
  const roundInput = document.getElementById('checkRound').value;
  const targetRound = roundInput ? parseInt(roundInput) : lottoData[0].round;
  const item = lottoData.find(d => d.round === targetRound);
  
  if (!item) {
    document.getElementById('checkResult').innerHTML = `<div class="alert alert-danger">í•´ë‹¹ íšŒì°¨ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</div>`;
    return;
  }
  
  const myNums = [...checkNumbers];
  const winNums = item.numbers;
  const bonus = item.bonus;
  
  const matched = myNums.filter(n => winNums.includes(n));
  const bonusMatched = myNums.includes(bonus);
  
  let rank = 'ë‚™ì²¨';
  let prize = 0;
  
  if (matched.length === 6) {
    rank = '1ë“±';
    prize = item.rank1?.prize || 0;
  } else if (matched.length === 5 && bonusMatched) {
    rank = '2ë“±';
    prize = item.rank2?.prize || 0;
  } else if (matched.length === 5) {
    rank = '3ë“±';
    prize = item.rank3?.prize || 0;
  } else if (matched.length === 4) {
    rank = '4ë“±';
    prize = item.rank4?.prize || 0;
  } else if (matched.length === 3) {
    rank = '5ë“±';
    prize = item.rank5?.prize || 0;
  }
  
  document.getElementById('checkResult').innerHTML = `
    <div class="result-box">
      <div class="check-result">
        <div class="check-rank">${rank}</div>
        ${prize > 0 ? `<div class="check-prize">${formatMoney(prize)}ì›</div>` : ''}
        <div class="check-matched">${matched.length}ê°œ ì¼ì¹˜${bonusMatched ? ' + ë³´ë„ˆìŠ¤' : ''}</div>
      </div>
      <div style="margin-top:16px;">
        <div style="font-size:12px;color:var(--text2);margin-bottom:8px;">${item.round}íšŒ ë‹¹ì²¨ë²ˆí˜¸</div>
        <div class="balls">${createBalls(item.numbers, item.bonus, 'sm')}</div>
      </div>
    </div>
  `;
}

// ì˜ˆì¸¡ ìƒì„± ê°œìˆ˜ ì¡°ì ˆ
function adjustCount(delta) {
  predictCount = Math.max(1, Math.min(10, predictCount + delta));
  document.getElementById('predictCount').textContent = predictCount;
}

// ì˜ˆì¸¡ ìƒì„±
function generatePrediction() {
  const strategy = document.getElementById('predictStrategy').value;
  const results = [];
  
  // ë¹ˆë„ ê³„ì‚°
  const freq = {};
  const lastSeen = {};
  for (let i = 1; i <= 45; i++) { freq[i] = 0; lastSeen[i] = 9999; }
  
  lottoData.forEach((item, idx) => {
    item.numbers.forEach(n => {
      freq[n]++;
      if (idx < lastSeen[n]) lastSeen[n] = idx;
    });
  });
  
  // ì‚¬ìš© ê°€ëŠ¥ ë²ˆí˜¸
  const available = [];
  for (let i = 1; i <= 45; i++) {
    if (!excludedNumbers.has(i)) available.push(i);
  }
  
  for (let set = 0; set < predictCount; set++) {
    const selected = [...requiredNumbers];
    const pool = available.filter(n => !requiredNumbers.has(n));
    
    while (selected.length < 6 && pool.length > 0) {
      let idx;
      
      switch (strategy) {
        case 'hot':
          pool.sort((a, b) => freq[b] - freq[a]);
          idx = Math.floor(Math.random() * Math.min(15, pool.length));
          break;
        case 'cold':
          pool.sort((a, b) => freq[a] - freq[b]);
          idx = Math.floor(Math.random() * Math.min(15, pool.length));
          break;
        case 'balanced':
          pool.sort((a, b) => (freq[b] + lastSeen[b]*2) - (freq[a] + lastSeen[a]*2));
          idx = Math.floor(Math.random() * Math.min(20, pool.length));
          break;
        case 'pattern':
          // í™€ì§ ê· í˜•
          const odds = selected.filter(n => n % 2 === 1).length;
          const needOdd = odds < 3;
          const filtered = pool.filter(n => needOdd ? n % 2 === 1 : n % 2 === 0);
          idx = Math.floor(Math.random() * (filtered.length || pool.length));
          if (filtered.length > 0) {
            selected.push(filtered[idx]);
            pool.splice(pool.indexOf(filtered[idx]), 1);
            continue;
          }
          break;
        case 'zscore':
          const mean = Object.values(freq).reduce((a, b) => a + b, 0) / 45;
          const std = Math.sqrt(Object.values(freq).reduce((s, v) => s + Math.pow(v - mean, 2), 0) / 45);
          pool.sort((a, b) => Math.abs(freq[b] - mean) - Math.abs(freq[a] - mean));
          idx = Math.floor(Math.random() * Math.min(15, pool.length));
          break;
        case 'trend':
          const recentFreq = {};
          for (let i = 1; i <= 45; i++) recentFreq[i] = 0;
          lottoData.slice(0, 10).forEach(item => item.numbers.forEach(n => recentFreq[n]++));
          pool.sort((a, b) => recentFreq[b] - recentFreq[a]);
          idx = Math.floor(Math.random() * Math.min(15, pool.length));
          break;
        default: // random
          idx = Math.floor(Math.random() * pool.length);
      }
      
      selected.push(pool[idx]);
      pool.splice(idx, 1);
    }
    
    results.push(selected.sort((a, b) => a - b));
  }
  
  // ê²°ê³¼ ë Œë”ë§
  document.getElementById('predictResults').innerHTML = results.map((nums, i) => `
    <div class="predict-result">
      <div class="predict-index">${i + 1}ë²ˆ ì„¸íŠ¸</div>
      <div class="balls">${createBalls(nums, null, 'sm')}</div>
    </div>
  `).join('');
}

// ì„¤ì •
function updateDataStatus() {
  const status = document.getElementById('dataStatus');
  if (lottoData.length === 0) {
    status.innerHTML = '<p>ë°ì´í„° ì—†ìŒ</p>';
    return;
  }
  
  const first = lottoData[lottoData.length - 1];
  const last = lottoData[0];
  
  status.innerHTML = `
    <table class="table">
      <tr><td>ì´ íšŒì°¨</td><td><strong>${lottoData.length}íšŒ</strong></td></tr>
      <tr><td>ë°ì´í„° ë²”ìœ„</td><td>${first.round}íšŒ ~ ${last.round}íšŒ</td></tr>
      <tr><td>ìµœì‹  ì¶”ì²¨ì¼</td><td>${formatDate(last.date)}</td></tr>
    </table>
  `;
}

function refreshData() {
  location.reload();
}

function exportData() {
  const blob = new Blob([JSON.stringify(lottoData, null, 2)], { type: 'application/json' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'lotto_data.json';
  a.click();
}

function clearCache() {
  if (confirm('ìºì‹œë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
    localStorage.clear();
    location.reload();
  }
}

// ê²€ìƒ‰ ì—”í„°í‚¤
document.getElementById('searchInput')?.addEventListener('keypress', e => {
  if (e.key === 'Enter') searchRound();
});

// ì´ˆê¸°í™” ì‹¤í–‰
init();
</script>

</body>
</html>
