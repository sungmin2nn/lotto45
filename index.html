<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#ffffff">
  <title>ğŸ”® í¬ë§íšŒë¡œ [ì„¤ë ˜]</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    :root{--bg:#f6f8fa;--card:#ffffff;--card2:#f6f8fa;--border:#d0d7de;--primary:#0969da;--primary2:#0550ae;--text:#1f2328;--text2:#656d76;--success:#1a7f37;--danger:#cf222e;--warning:#9a6700}
    html,body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);min-height:100vh;color:var(--text)}
    .app{max-width:500px;margin:0 auto;padding:16px;padding-bottom:80px}
    .header{text-align:center;background:linear-gradient(135deg,#24292f,#32383f);color:#fff;margin:-16px -16px 16px;padding:24px 16px;border-bottom:1px solid var(--border)}
    .header h1{font-size:1.5rem;margin-bottom:4px}.header p{font-size:12px;opacity:.8}
    .bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--card);display:flex;justify-content:space-around;padding:8px 0;padding-bottom:max(8px,env(safe-area-inset-bottom));border-top:1px solid var(--border);z-index:100}
    .nav-item{display:flex;flex-direction:column;align-items:center;padding:8px 12px;color:var(--text2);font-size:10px;background:none;border:none;cursor:pointer}
    .nav-item.active{color:var(--primary)}.nav-item span{font-size:20px;margin-bottom:2px}
    .card{background:var(--card);border-radius:12px;padding:16px;margin-bottom:12px;border:1px solid var(--border)}
    .card-title{font-size:14px;font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;color:var(--text)}
    .card-highlight{background:linear-gradient(135deg,rgba(9,105,218,.05),rgba(5,80,174,.05));border:1px solid rgba(9,105,218,.3)}
    .balls{display:flex;gap:6px;justify-content:center;align-items:center;flex-wrap:wrap}
    .ball{width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;color:#fff}
    .ball.sm{width:32px;height:32px;font-size:12px}.ball.xs{width:26px;height:26px;font-size:10px}
    .ball.b1{background:linear-gradient(135deg,#f0b400,#d49a00)}.ball.b2{background:linear-gradient(135deg,#218bff,#0969da)}
    .ball.b3{background:linear-gradient(135deg,#fa4549,#cf222e)}.ball.b4{background:linear-gradient(135deg,#6e7781,#57606a)}
    .ball.b5{background:linear-gradient(135deg,#2da44e,#1a7f37)}.ball.bonus{box-shadow:0 0 0 3px var(--card),0 0 0 5px var(--primary)}
    .ball.matched{box-shadow:0 0 0 3px var(--success)}.plus{color:var(--text2);font-size:16px;margin:0 4px}

    .accordion{border-radius:10px;overflow:hidden;background:var(--card);border:1px solid var(--border);margin-bottom:12px}
    .accordion-header{padding:14px 16px;display:flex;justify-content:space-between;align-items:center;cursor:pointer;font-size:13px}
    .accordion-header:hover{background:var(--card2)}
    .accordion-icon{transition:transform .2s;color:var(--text2)}
    .accordion.open .accordion-icon{transform:rotate(180deg)}
    .accordion-content{max-height:0;overflow:hidden;transition:max-height .3s}
    .accordion.open .accordion-content{max-height:500px}
    .accordion-inner{padding:0 16px 16px}

    .number-grid{display:grid;grid-template-columns:repeat(9,1fr);gap:4px}
    .number-btn{aspect-ratio:1;border:1px solid var(--border);border-radius:8px;font-weight:600;font-size:11px;cursor:pointer;transition:all .15s;background:var(--card)}
    .number-btn.b1{background:#fffbeb;color:#92400e;border-color:#fde68a}.number-btn.b2{background:#eff6ff;color:#1e40af;border-color:#bfdbfe}
    .number-btn.b3{background:#fef2f2;color:#991b1b;border-color:#fecaca}.number-btn.b4{background:#f3f4f6;color:#374151;border-color:#d1d5db}
    .number-btn.b5{background:#f0fdf4;color:#166534;border-color:#bbf7d0}
    .number-btn.selected{background:var(--primary)!important;color:#fff!important;border-color:var(--primary)!important}
    .number-btn.excluded{background:var(--danger)!important;color:#fff!important;border-color:var(--danger)!important}
    .number-btn.required{background:var(--success)!important;color:#fff!important;border-color:var(--success)!important}

    .btn{width:100%;padding:14px;border:none;border-radius:8px;font-size:15px;font-weight:600;cursor:pointer}
    .btn:active{transform:scale(.98)}.btn-primary{background:var(--primary);color:#fff}
    .btn-primary:hover{background:var(--primary2)}
    .btn-success{background:var(--success);color:#fff}
    .btn-outline{background:var(--card);border:1px solid var(--border);color:var(--text)}
    .btn-outline:hover{background:var(--card2)}
    .btn-sm{padding:10px 16px;font-size:13px;width:auto}

    .round-nav{display:flex;align-items:center;justify-content:center;gap:16px;margin-bottom:16px}
    .round-nav button{width:44px;height:44px;border-radius:50%;border:1px solid var(--border);background:var(--card);color:var(--text);font-size:18px;cursor:pointer}
    .round-nav button:disabled{opacity:.3}.round-nav button:hover:not(:disabled){background:var(--card2)}
    .round-nav button:active:not(:disabled){background:var(--primary);color:#fff}
    .round-display{text-align:center;cursor:pointer;min-width:120px}
    .round-num{font-size:24px;font-weight:800;color:var(--primary)}
    .round-date{font-size:12px;color:var(--text2)}

    .prize-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-top:12px}
    .prize-item{background:var(--card2);padding:10px;border-radius:8px;text-align:center;border:1px solid var(--border)}
    .prize-item.main{grid-column:span 2;background:linear-gradient(135deg,#fffbeb,#fef3c7);border:1px solid #fde68a}
    .prize-label{font-size:10px;color:var(--text2)}.prize-value{font-size:16px;font-weight:700;color:var(--text)}
    .prize-value.highlight{color:#b45309;font-size:20px}
    .prize-sub{font-size:10px;color:var(--text2);margin-top:2px}
    .prize-net{font-size:11px;color:var(--success);margin-top:2px}

    .check-result{text-align:center;padding:16px;background:var(--card2);border-radius:10px;margin:12px 0;border:1px solid var(--border)}
    .check-rank{font-size:32px;font-weight:800}
    .check-rank.win{color:#b45309}
    .check-rank.lose{color:var(--text2)}

    .info-box{background:var(--card2);border-radius:8px;padding:12px;font-size:12px;line-height:1.6;border:1px solid var(--border)}
    .info-box h4{color:var(--primary);margin-bottom:8px;font-size:13px}
    .info-row{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border)}
    .info-row:last-child{border:none}

    .modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(27,31,36,.5);z-index:200;align-items:center;justify-content:center}
    .modal-overlay.active{display:flex}
    .modal{background:var(--card);border-radius:12px;padding:24px;width:90%;max-width:320px;border:1px solid var(--border);box-shadow:0 8px 24px rgba(140,149,159,.2)}
    .modal h3{margin-bottom:16px;text-align:center;font-size:16px;color:var(--text)}
    .modal input{width:100%;padding:14px;border:1px solid var(--border);border-radius:8px;background:var(--card);color:var(--text);font-size:18px;text-align:center;margin-bottom:12px}
    .modal input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(9,105,218,.15)}
    .modal-buttons{display:flex;gap:8px}.modal-buttons button{flex:1}

    .tabs{display:flex;gap:6px;margin-bottom:16px}
    .tab{flex:1;padding:10px;border-radius:8px;font-size:12px;background:var(--card);color:var(--text2);border:1px solid var(--border);cursor:pointer;text-align:center}
    .tab.active{background:var(--primary);color:#fff;border-color:var(--primary)}

    .stat-table{width:100%;border-collapse:collapse;font-size:11px}
    .stat-table th,.stat-table td{padding:8px 6px;text-align:center;border-bottom:1px solid var(--border)}
    .stat-table th{background:var(--card2);color:var(--text2);cursor:pointer;position:sticky;top:0;font-weight:500}
    .stat-table th:hover{background:var(--primary);color:#fff}
    .stat-table tr:hover{background:rgba(9,105,218,.05)}
    .table-scroll{max-height:350px;overflow-y:auto;border-radius:8px;border:1px solid var(--border)}

    .filter-bar{display:flex;gap:6px;margin-bottom:12px;flex-wrap:wrap}
    .filter-chip{padding:6px 10px;border-radius:20px;font-size:10px;background:var(--card);color:var(--text2);border:1px solid var(--border);cursor:pointer}
    .filter-chip.active{background:var(--primary);color:#fff;border-color:var(--primary)}

    .help-icon{display:inline-flex;align-items:center;justify-content:center;width:16px;height:16px;border-radius:50%;background:var(--card2);color:var(--text2);font-size:10px;cursor:pointer;margin-left:4px;border:1px solid var(--border)}
    .help-icon:hover{background:var(--primary);color:#fff;border-color:var(--primary)}

    .tooltip{position:relative}.tooltip-text{display:none;position:absolute;bottom:100%;left:50%;transform:translateX(-50%);background:var(--card);border:1px solid var(--border);padding:8px 12px;border-radius:8px;font-size:11px;white-space:nowrap;z-index:10;box-shadow:0 4px 12px rgba(140,149,159,.15)}
    .tooltip:hover .tooltip-text{display:block}

    .checkbox-group{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:12px}
    .checkbox-item{display:flex;align-items:center;gap:6px;padding:8px 12px;background:var(--card);border:1px solid var(--border);border-radius:8px;cursor:pointer;font-size:12px}
    .checkbox-item input{display:none}
    .checkbox-item.checked{background:var(--primary);color:#fff;border-color:var(--primary)}
    .checkbox-box{width:16px;height:16px;border:2px solid var(--border);border-radius:4px;display:flex;align-items:center;justify-content:center}
    .checkbox-item.checked .checkbox-box{border-color:#fff;background:rgba(255,255,255,.2)}
    .checkbox-item.checked .checkbox-box::after{content:'âœ“';color:#fff;font-size:10px}

    .predict-result{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:8px}
    .predict-index{font-size:11px;color:var(--primary);margin-bottom:8px}

    .section{display:none}.section.active{display:block}
    .loading{text-align:center;padding:60px 20px}
    .spinner{width:40px;height:40px;border:4px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin .8s linear infinite;margin:0 auto 16px}
    @keyframes spin{to{transform:rotate(360deg)}}

    .alert{padding:10px 12px;border-radius:8px;font-size:12px;margin-bottom:12px}
    .alert-danger{background:#fef2f2;color:var(--danger);border:1px solid #fecaca}
    .alert-success{background:#f0fdf4;color:var(--success);border:1px solid #bbf7d0}

    .selected-display{display:flex;align-items:center;gap:8px;min-height:32px}
    .selected-label{font-size:11px;color:var(--text2)}

    .wheel-section{margin-top:16px;padding-top:16px;border-top:1px solid var(--border)}
    .wheel-info{font-size:11px;color:var(--text2);margin-bottom:8px}
    .wheel-result{max-height:200px;overflow-y:auto}
    .wheel-item{padding:8px;background:var(--card2);border:1px solid var(--border);border-radius:8px;margin-bottom:4px;font-size:12px;text-align:center}

    .input{width:100%;padding:12px;border:1px solid var(--border);border-radius:8px;background:var(--card);color:var(--text);font-size:14px}
    .input:focus{outline:none;border-color:var(--primary);box-shadow:0 0 0 3px rgba(9,105,218,.15)}

    .pair-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin-top:8px}
    .pair-item{background:var(--card2);padding:8px;border-radius:8px;text-align:center;font-size:11px;border:1px solid var(--border)}
    .pair-num{font-weight:700;color:var(--primary)}
  </style>
</head>
<body>
<div class="app">
  <header class="header"><h1>ğŸ”® í¬ë§íšŒë¡œ [ì„¤ë ˜]</h1><p>ë‹¹ì²¨ë²ˆí˜¸ ì¡°íšŒ Â· í†µê³„ ë¶„ì„ Â· AI ì˜ˆì¸¡</p></header>
  
  <div id="loading" class="loading"><div class="spinner"></div><p>ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p></div>
  
  <!-- í™ˆ -->
  <div id="sec-home" class="section">
    <!-- ë‚´ ë²ˆí˜¸ ì…ë ¥ ì•„ì½”ë””ì–¸ -->
    <div class="accordion open" id="myNumAccordion">
      <div class="accordion-header" onclick="toggleAccordion('myNumAccordion')">
        <div>
          <span>ğŸ« ë‚´ ë²ˆí˜¸</span>
          <span id="myNumDisplay" style="margin-left:8px"></span>
        </div>
        <span class="accordion-icon">â–¼</span>
      </div>
      <div class="accordion-content">
        <div class="accordion-inner">
          <p style="font-size:11px;color:var(--text2);margin-bottom:10px">6ê°œ ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</p>
          <div class="number-grid" id="checkGrid"></div>
          <button class="btn btn-outline btn-sm" onclick="clearCheck()" style="margin-top:8px;width:auto">ì´ˆê¸°í™”</button>
        </div>
      </div>
    </div>
    
    <button class="btn btn-success" onclick="checkMyNumbers()" style="margin-bottom:16px">ğŸ” ë‹¹ì²¨ í™•ì¸</button>
    
    <div id="checkResult"></div>
    
    <!-- íšŒì°¨ ì •ë³´ -->
    <div class="card card-highlight">
      <div class="round-nav">
        <button onclick="prevRound()" id="prevBtn">â—€</button>
        <div class="round-display" onclick="openRoundModal()">
          <div class="round-num" id="currentRound">-</div>
          <div class="round-date" id="currentDate">í„°ì¹˜í•˜ì—¬ íšŒì°¨ ì…ë ¥</div>
        </div>
        <button onclick="nextOrCollect()" id="nextBtn">â–¶</button>
      </div>
      
      <div class="balls" id="currentBalls"></div>
      
      <div class="prize-grid">
        <div class="prize-item main">
          <div class="prize-label">ğŸ† 1ë“± (1ì¸ë‹¹)</div>
          <div class="prize-value highlight" id="prize1">-</div>
          <div class="prize-net" id="prize1Net">ì‹¤ìˆ˜ë ¹: -</div>
          <div class="prize-sub" id="prize1Info">-</div>
        </div>
        <div class="prize-item">
          <div class="prize-label">2ë“±</div>
          <div class="prize-value" id="prize2">-</div>
          <div class="prize-sub" id="prize2Info">-</div>
        </div>
        <div class="prize-item">
          <div class="prize-label">3ë“±</div>
          <div class="prize-value" id="prize3">-</div>
          <div class="prize-sub" id="prize3Info">-</div>
        </div>
        <div class="prize-item">
          <div class="prize-label">ì´ íŒë§¤ì•¡</div>
          <div class="prize-value" id="totalSales">-</div>
        </div>
        <div class="prize-item">
          <div class="prize-label">ì´ ë‹¹ì²¨ì</div>
          <div class="prize-value" id="totalWinners">-</div>
        </div>
      </div>

      <!-- ì˜ˆì¸¡ ì¡°ê±´ ì •í•©ì„± -->
      <div style="margin-top:12px;padding-top:12px;border-top:1px solid var(--border)">
        <div style="font-size:11px;color:var(--text2);margin-bottom:8px">ğŸ“Š ì˜ˆì¸¡ ì¡°ê±´ ì •í•©ì„±</div>
        <div id="validityCheck" style="display:grid;grid-template-columns:repeat(2,1fr);gap:6px;font-size:11px"></div>
      </div>
    </div>

    <!-- ë‹¹ì²¨ ì¡°ê±´ ì•ˆë‚´ -->
    <div class="card">
      <div class="card-title">ğŸ“‹ ë‹¹ì²¨ ì¡°ê±´</div>
      <div class="info-box">
        <div class="info-row"><span>ğŸ¥‡ 1ë“±</span><span>6ê°œ ë²ˆí˜¸ ì¼ì¹˜</span></div>
        <div class="info-row"><span>ğŸ¥ˆ 2ë“±</span><span>5ê°œ + ë³´ë„ˆìŠ¤ ì¼ì¹˜</span></div>
        <div class="info-row"><span>ğŸ¥‰ 3ë“±</span><span>5ê°œ ë²ˆí˜¸ ì¼ì¹˜</span></div>
        <div class="info-row"><span>4ë“±</span><span>4ê°œ ë²ˆí˜¸ ì¼ì¹˜ (ê³ ì • 5ë§Œì›)</span></div>
        <div class="info-row"><span>5ë“±</span><span>3ê°œ ë²ˆí˜¸ ì¼ì¹˜ (ê³ ì • 5ì²œì›)</span></div>
      </div>
    </div>
  </div>
  
  <!-- ì˜ˆì¸¡ -->
  <div id="sec-predict" class="section">
    <div class="card">
      <div class="card-title">âš™ï¸ ì˜ˆì¸¡ ì˜µì…˜ <span class="help-icon tooltip">?<span class="tooltip-text">ì²´í¬í•œ ì¡°ê±´ë“¤ì„ ì¡°í•©í•˜ì—¬ ì˜ˆì¸¡í•©ë‹ˆë‹¤<br>ì²´í¬ ì—†ìœ¼ë©´ ì™„ì „ ëœë¤</span></span></div>
      
      <div class="checkbox-group" id="optionGroup">
        <label class="checkbox-item" onclick="toggleOption(this,'oddEven')">
          <div class="checkbox-box"></div><span>í™€ì§ ê· í˜•(3:3)</span>
        </label>
        <label class="checkbox-item" onclick="toggleOption(this,'highLow')">
          <div class="checkbox-box"></div><span>ê³ ì € ê· í˜•(3:3)</span>
        </label>
        <label class="checkbox-item" onclick="toggleOption(this,'sumRange')">
          <div class="checkbox-box"></div><span>ì´í•© 100-175</span>
        </label>
        <label class="checkbox-item" onclick="toggleOption(this,'hot')">
          <div class="checkbox-box"></div><span>HOT ë²ˆí˜¸ í¬í•¨</span>
        </label>
        <label class="checkbox-item" onclick="toggleOption(this,'cold')">
          <div class="checkbox-box"></div><span>COLD ë²ˆí˜¸ í¬í•¨</span>
        </label>
        <label class="checkbox-item" onclick="toggleOption(this,'noConsec')">
          <div class="checkbox-box"></div><span>ì—°ì†ë²ˆí˜¸ ì œì™¸</span>
        </label>
        <label class="checkbox-item" onclick="toggleOption(this,'colorBalance')">
          <div class="checkbox-box"></div><span>ìƒ‰ìƒ ê· í˜•</span>
        </label>
        <label class="checkbox-item" onclick="toggleOption(this,'recentTrend')">
          <div class="checkbox-box"></div><span>ìµœê·¼ íŠ¸ë Œë“œ</span>
        </label>
        <label class="checkbox-item" onclick="toggleOption(this,'longAbsent')">
          <div class="checkbox-box"></div><span>ë¯¸ì¶œí˜„ ë²ˆí˜¸</span>
        </label>
        <label class="checkbox-item" onclick="toggleOption(this,'endNumBalance')">
          <div class="checkbox-box"></div><span>ëìˆ˜ ë¶„ì‚°</span>
        </label>
      </div>
      
      <!-- ì œì™¸ ë²ˆí˜¸ ì•„ì½”ë””ì–¸ -->
      <div class="accordion" id="excludeAccordion">
        <div class="accordion-header" onclick="toggleAccordion('excludeAccordion')">
          <div>
            <span>ğŸš« ì œì™¸ ë²ˆí˜¸</span>
            <span id="excludeDisplay" style="margin-left:8px;color:var(--danger)"></span>
          </div>
          <span class="accordion-icon">â–¼</span>
        </div>
        <div class="accordion-content">
          <div class="accordion-inner">
            <div class="number-grid" id="excludeGrid"></div>
          </div>
        </div>
      </div>
      
      <!-- í•„ìˆ˜ ë²ˆí˜¸ ì•„ì½”ë””ì–¸ -->
      <div class="accordion" id="requireAccordion">
        <div class="accordion-header" onclick="toggleAccordion('requireAccordion')">
          <div>
            <span>â­ í•„ìˆ˜ ë²ˆí˜¸ (ìµœëŒ€5ê°œ)</span>
            <span id="requireDisplay" style="margin-left:8px;color:var(--success)"></span>
          </div>
          <span class="accordion-icon">â–¼</span>
        </div>
        <div class="accordion-content">
          <div class="accordion-inner">
            <div class="number-grid" id="requireGrid"></div>
          </div>
        </div>
      </div>
      
      <div style="display:flex;align-items:center;gap:12px;margin:16px 0">
        <span style="font-size:12px;color:var(--text2)">ìƒì„± ê°œìˆ˜:</span>
        <button class="btn btn-outline btn-sm" onclick="adjustCount(-1)">âˆ’</button>
        <span id="predictCount" style="font-size:18px;font-weight:700;min-width:30px;text-align:center">3</span>
        <button class="btn btn-outline btn-sm" onclick="adjustCount(1)">+</button>
      </div>
      
      <button class="btn btn-primary" onclick="generatePrediction()">âœ¨ ë²ˆí˜¸ ìƒì„±</button>
    </div>
    
    <div id="predictResults"></div>
    
    <!-- ì¶•ì†Œ ì‹œìŠ¤í…œ -->
    <div class="card">
      <div class="card-title">ğŸ¯ ì¶•ì†Œ ì‹œìŠ¤í…œ <span class="help-icon tooltip">?<span class="tooltip-text">Nê°œ ë²ˆí˜¸ ì„ íƒ â†’ ê°€ëŠ¥í•œ 6ê°œ ì¡°í•© ìƒì„±<br>ì˜ˆ: 8ê°œ ì„ íƒ â†’ 28ê°œ ì¡°í•©</span></span></div>
      <div class="accordion" id="wheelAccordion">
        <div class="accordion-header" onclick="toggleAccordion('wheelAccordion')">
          <div>
            <span>ë²ˆí˜¸ ì„ íƒ</span>
            <span id="wheelDisplay" style="margin-left:8px;color:var(--primary)"></span>
          </div>
          <span class="accordion-icon">â–¼</span>
        </div>
        <div class="accordion-content">
          <div class="accordion-inner">
            <div class="number-grid" id="wheelGrid"></div>
          </div>
        </div>
      </div>
      <button class="btn btn-outline" onclick="generateWheel()">ì¡°í•© ìƒì„±</button>
      <div id="wheelResults" style="margin-top:12px"></div>
    </div>
  </div>
  
  <!-- í†µê³„ -->
  <div id="sec-stats" class="section">
    <!-- ê¸°ê°„ ì„¤ì • -->
    <div class="card" style="margin-bottom:12px">
      <div class="card-title">ğŸ“… ë¶„ì„ ê¸°ê°„</div>
      <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px;flex-wrap:wrap">
        <select id="statStartRound" class="input" style="width:100px;padding:8px" onchange="updateStatRange()"></select>
        <span style="color:var(--text2)">~</span>
        <select id="statEndRound" class="input" style="width:100px;padding:8px" onchange="updateStatRange()"></select>
        <span style="font-size:12px;color:var(--text2)" id="statRangeInfo">(0íšŒì°¨)</span>
      </div>
      <div class="filter-bar">
        <button class="filter-chip" onclick="setStatRange('recent10',this)">ìµœê·¼ 10íšŒ</button>
        <button class="filter-chip" onclick="setStatRange('recent50',this)">ìµœê·¼ 50íšŒ</button>
        <button class="filter-chip" onclick="setStatRange('month',this)">ì´ë²ˆë‹¬</button>
        <button class="filter-chip" onclick="setStatRange('3months',this)">3ê°œì›”</button>
        <button class="filter-chip" onclick="setStatRange('year',this)">ì˜¬í•´</button>
        <button class="filter-chip active" onclick="setStatRange('all',this)" id="statRangeAllBtn">ì „ì²´</button>
      </div>
    </div>

    <!-- ë¹ˆë„ ê¸°ë°˜ ì¶”ì²œ -->
    <div class="card" style="margin-bottom:12px">
      <div class="card-title">ğŸ¯ ë¹ˆë„ ê¸°ë°˜ ë²ˆí˜¸ ì¶”ì²œ <span class="help-icon tooltip">?<span class="tooltip-text">ì„ íƒí•œ ê¸°ê°„ ë™ì•ˆ<br>ê°€ì¥ ë§ì´ ì¶œí˜„í•œ ë²ˆí˜¸ ì¡°í•©</span></span></div>
      <div id="freqRecommend" style="text-align:center;padding:12px">
        <div class="balls" id="freqBalls" style="margin-bottom:12px"></div>
        <div style="font-size:11px;color:var(--text2)" id="freqInfo"></div>
      </div>
      <button class="btn btn-outline btn-sm" onclick="addFreqToPredict()" style="margin-top:8px">â• ë‚´ ì˜ˆì¸¡ì— ì¶”ê°€</button>
    </div>

    <!-- ë§¤ì¹­ ì˜µì…˜ë³„ ë‹¹ì²¨ íšŸìˆ˜ -->
    <div class="card" style="margin-bottom:12px">
      <div class="card-title">ğŸ“Š ì¡°ê±´ë³„ ë‹¹ì²¨ ë¶„ì„ <span class="help-icon tooltip">?<span class="tooltip-text">í•´ë‹¹ ì¡°ê±´ì„ ë§Œì¡±í•œ íšŒì°¨ ìˆ˜<br>vs ì‹¤ì œ 1~5ë“± ë‹¹ì²¨</span></span></div>
      <div id="conditionStats" style="font-size:12px"></div>
    </div>

    <div class="tabs">
      <button class="tab active" onclick="showStatTab('number',this)">ë²ˆí˜¸ë³„</button>
      <button class="tab" onclick="showStatTab('round',this)">íšŒì°¨ë³„</button>
    </div>

    <!-- ë²ˆí˜¸ë³„ í†µê³„ -->
    <div id="stat-number" class="stat-content">
      <div class="card">
        <div class="card-title">ğŸ“Š ë²ˆí˜¸ë³„ í†µê³„ 
          <span class="help-icon tooltip">?<span class="tooltip-text">HOT: Z>1.5 (í‰ê· ë³´ë‹¤ ë§ì´ ì¶œí˜„)<br>COLD: Z<-1.5 (í‰ê· ë³´ë‹¤ ì ê²Œ ì¶œí˜„)<br>Z-Score = (ì¶œí˜„-í‰ê· )/í‘œì¤€í¸ì°¨</span></span>
        </div>
        <div class="filter-bar">
          <button class="filter-chip active" onclick="filterNum('all',this)">ì „ì²´</button>
          <button class="filter-chip" onclick="filterNum('1-10',this)">1-10</button>
          <button class="filter-chip" onclick="filterNum('11-20',this)">11-20</button>
          <button class="filter-chip" onclick="filterNum('21-30',this)">21-30</button>
          <button class="filter-chip" onclick="filterNum('31-40',this)">31-40</button>
          <button class="filter-chip" onclick="filterNum('41-45',this)">41-45</button>
          <button class="filter-chip" onclick="filterNum('hot',this)">ğŸ”¥HOT</button>
          <button class="filter-chip" onclick="filterNum('cold',this)">â„ï¸COLD</button>
        </div>
        <div class="table-scroll">
          <table class="stat-table">
            <thead><tr>
              <th onclick="sortNum('num')">ë²ˆí˜¸</th>
              <th onclick="sortNum('count')">ì¶œí˜„</th>
              <th onclick="sortNum('percent')">ë¹„ìœ¨</th>
              <th onclick="sortNum('last')">ë¯¸ì¶œí˜„</th>
              <th onclick="sortNum('zscore')">Zê°’</th>
              <th>ìƒíƒœ</th>
            </tr></thead>
            <tbody id="numTableBody"></tbody>
          </table>
        </div>
      </div>
      
      <div class="card">
        <div class="card-title">ğŸ’‘ ê¶í•© ë²ˆí˜¸ <span class="help-icon tooltip">?<span class="tooltip-text">íŠ¹ì • ë²ˆí˜¸ì™€ í•¨ê»˜<br>ìì£¼ ì¶œí˜„í•˜ëŠ” ë²ˆí˜¸</span></span></div>
        <div style="display:flex;gap:8px;align-items:center;margin-bottom:12px">
          <span style="font-size:12px;color:var(--text2)">ë²ˆí˜¸ ì„ íƒ:</span>
          <select id="pairSelect" class="input" style="width:80px;padding:8px" onchange="showPairNumbers()">
            <option value="">-</option>
          </select>
        </div>
        <div id="pairResult"></div>
      </div>
    </div>
    
    <!-- íšŒì°¨ë³„ í†µê³„ -->
    <div id="stat-round" class="stat-content" style="display:none">
      <div class="card">
        <div class="card-title">âš–ï¸ í™€ì§ ë¶„í¬</div>
        <div class="table-scroll" style="max-height:200px">
          <table class="stat-table">
            <thead><tr><th>í™€:ì§</th><th>íšŸìˆ˜</th><th>ë¹„ìœ¨</th></tr></thead>
            <tbody id="oddEvenBody"></tbody>
          </table>
        </div>
      </div>
      
      <div class="card">
        <div class="card-title">ğŸ“ ê³ ì € ë¶„í¬ (1-22 vs 23-45)</div>
        <div class="table-scroll" style="max-height:200px">
          <table class="stat-table">
            <thead><tr><th>ì €:ê³ </th><th>íšŸìˆ˜</th><th>ë¹„ìœ¨</th></tr></thead>
            <tbody id="highLowBody"></tbody>
          </table>
        </div>
      </div>
      
      <div class="card">
        <div class="card-title">ğŸ”¢ ì´í•© í†µê³„</div>
        <div id="sumStats" class="info-box"></div>
      </div>
      
      <div class="card">
        <div class="card-title">ğŸ”— ì—°ì†ë²ˆí˜¸ / ACê°’</div>
        <div id="consecStats" class="info-box"></div>
      </div>
      
      <div class="card">
        <div class="card-title">ğŸ”„ ì´ì›” ë²ˆí˜¸ <span class="help-icon tooltip">?<span class="tooltip-text">ì´ì „ íšŒì°¨ ë²ˆí˜¸ ì¤‘<br>ë‹¤ìŒ íšŒì°¨ì— ë‹¤ì‹œ ë‚˜ì˜¨ ê°œìˆ˜</span></span></div>
        <div id="carryStats" class="info-box"></div>
      </div>
      
      <div class="card">
        <div class="card-title">ğŸ”š ëìˆ˜ ë¶„í¬ (0-9)</div>
        <div class="table-scroll" style="max-height:200px">
          <table class="stat-table">
            <thead><tr><th>ëìˆ˜</th><th>íšŸìˆ˜</th><th>ë¹„ìœ¨</th></tr></thead>
            <tbody id="endNumBody"></tbody>
          </table>
        </div>
      </div>
      
      <div class="card">
        <div class="card-title">ğŸ“ ë²ˆí˜¸ ê°„ê²© ë¶„ì„</div>
        <div id="gapStats" class="info-box"></div>
      </div>
      
      <div class="card">
        <div class="card-title">ğŸ¨ ìƒ‰ìƒ(ë²ˆí˜¸ëŒ€) ë¶„í¬</div>
        <div class="table-scroll" style="max-height:200px">
          <table class="stat-table">
            <thead><tr><th>ë²ˆí˜¸ëŒ€</th><th>í‰ê· ê°œìˆ˜</th><th>ë¹„ìœ¨</th></tr></thead>
            <tbody id="colorBody"></tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- ë‚´ ì˜ˆì¸¡ -->
  <div id="sec-mypredict" class="section">
    <div class="card">
      <div class="card-title">ğŸ“ ë‚´ ì˜ˆì¸¡ ê¸°ë¡</div>
      <div id="myPredictSummary" style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:12px">
        <div style="text-align:center;padding:10px;background:var(--card2);border:1px solid var(--border);border-radius:8px">
          <div style="font-size:18px;font-weight:700;color:var(--text)" id="mpTotal">0</div>
          <div style="font-size:10px;color:var(--text2)">ì´ ì˜ˆì¸¡</div>
        </div>
        <div style="text-align:center;padding:10px;background:#f0fdf4;border:1px solid #bbf7d0;border-radius:8px">
          <div style="font-size:18px;font-weight:700;color:var(--success)" id="mpWin">0</div>
          <div style="font-size:10px;color:var(--text2)">ë‹¹ì²¨</div>
        </div>
        <div style="text-align:center;padding:10px;background:#eff6ff;border:1px solid #bfdbfe;border-radius:8px">
          <div style="font-size:18px;font-weight:700;color:var(--primary)" id="mpPending">0</div>
          <div style="font-size:10px;color:var(--text2)">ëŒ€ê¸°ì¤‘</div>
        </div>
      </div>
      <button class="btn btn-outline btn-sm" onclick="openAddPredictModal()" style="margin-bottom:8px">â• ì§ì ‘ ì¶”ê°€</button>
    </div>

    <!-- ëŒ€ê¸°ì¤‘ ì˜ˆì¸¡ -->
    <div class="card">
      <div class="card-title">â³ ëŒ€ê¸°ì¤‘ (ê²°ê³¼ ë¯¸í™•ì •)</div>
      <div id="pendingPredicts" style="font-size:12px;color:var(--text2)">ì˜ˆì¸¡ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
    </div>

    <!-- ì™„ë£Œëœ ì˜ˆì¸¡ -->
    <div class="card">
      <div class="card-title">âœ… ì™„ë£Œ (ê²°ê³¼ í™•ì •)</div>
      <div id="completedPredicts" style="font-size:12px;color:var(--text2)">ì˜ˆì¸¡ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
    </div>

    <!-- ì„±ê³¼ ë¶„ì„ -->
    <div class="card">
      <div class="card-title">ğŸ“ˆ ì„±ê³¼ ë¶„ì„</div>
      <div id="performanceAnalysis">
        <div style="color:var(--text2);font-size:12px;text-align:center;padding:12px">ì˜ˆì¸¡ ê¸°ë¡ì´ ìŒ“ì´ë©´ ë¶„ì„ ë°ì´í„°ê°€ í‘œì‹œë©ë‹ˆë‹¤</div>
      </div>
    </div>

    <!-- ë²ˆí˜¸ ì„ í˜¸ë„ -->
    <div class="card">
      <div class="card-title">ğŸ”¢ ë‚´ ë²ˆí˜¸ ì„ í˜¸ë„</div>
      <div id="numberPreference">
        <div style="color:var(--text2);font-size:12px;text-align:center;padding:12px">ì˜ˆì¸¡ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>
      </div>
    </div>
  </div>

  <!-- ì„¤ì • -->
  <div id="sec-settings" class="section">
    <div class="card">
      <div class="card-title">ğŸ“Š ë°ì´í„° í˜„í™©</div>
      <div id="dataStatus" class="info-box"></div>
    </div>
    <div class="card">
      <div class="card-title">ğŸ”„ ê´€ë¦¬</div>
      <button class="btn btn-primary" onclick="manualCollect()" style="margin-bottom:8px" id="collectBtn">ğŸ“¡ ìˆ˜ë™ ìˆ˜ì§‘</button>
      <button class="btn btn-outline" onclick="location.reload()" style="margin-bottom:8px">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
      <button class="btn btn-outline" onclick="exportData()">ğŸ“¤ ë°ì´í„° ë‚´ë³´ë‚´ê¸°</button>
      <div id="collectStatus" style="margin-top:8px;font-size:12px;color:var(--text2)"></div>
    </div>
    <div class="card">
      <div class="card-title">â„¹ï¸ ìš©ì–´ ì„¤ëª…</div>
      <div class="info-box">
        <div class="info-row"><span>Z-Score</span><span>(ì¶œí˜„ìˆ˜-í‰ê· )/í‘œì¤€í¸ì°¨</span></div>
        <div class="info-row"><span>HOT</span><span>Z > 1.5 (ìì£¼ ì¶œí˜„)</span></div>
        <div class="info-row"><span>COLD</span><span>Z < -1.5 (ì ê²Œ ì¶œí˜„)</span></div>
        <div class="info-row"><span>ACê°’</span><span>ë²ˆí˜¸ê°„ ì°¨ì´ì˜ ì¢…ë¥˜ ìˆ˜ - 5</span></div>
        <div class="info-row"><span>ì´ì›”</span><span>ì´ì „íšŒì°¨ ë²ˆí˜¸ ì¬ì¶œí˜„</span></div>
      </div>
    </div>
    <div class="card">
      <p style="font-size:11px;color:var(--text2);line-height:1.6">âš ï¸ ë¡œë˜ëŠ” ì™„ì „í•œ ë¬´ì‘ìœ„ ì¶”ì²¨ì…ë‹ˆë‹¤. ëª¨ë“  í†µê³„ì™€ ì˜ˆì¸¡ì€ ì°¸ê³ ìš©ì´ë©° ë‹¹ì²¨ì„ ë³´ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
    </div>
  </div>
</div>

<!-- íšŒì°¨ ì…ë ¥ ëª¨ë‹¬ -->
<div class="modal-overlay" id="roundModal">
  <div class="modal">
    <h3>íšŒì°¨ ì…ë ¥</h3>
    <input type="number" id="roundInput" placeholder="íšŒì°¨ ë²ˆí˜¸" inputmode="numeric">
    <div class="modal-buttons">
      <button class="btn btn-outline" onclick="closeRoundModal()">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="goToRound()">ì´ë™</button>
    </div>
  </div>
</div>

<!-- ì˜ˆì¸¡ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal-overlay" id="predictModal">
  <div class="modal" style="max-width:360px">
    <h3 id="predictModalTitle">ì˜ˆì¸¡ ì¶”ê°€</h3>
    <input type="hidden" id="predictEditId">
    <div style="margin-bottom:12px">
      <label style="font-size:11px;color:var(--text2);display:block;margin-bottom:4px">ëŒ€ìƒ íšŒì°¨</label>
      <input type="number" id="predictRoundInput" placeholder="ì˜ˆ: 1209" inputmode="numeric" style="width:100%;padding:12px;border:none;border-radius:10px;background:var(--card2);color:var(--text);font-size:14px">
    </div>
    <div style="margin-bottom:12px">
      <label style="font-size:11px;color:var(--text2);display:block;margin-bottom:4px">ë²ˆí˜¸ 6ê°œ (ì‰¼í‘œë¡œ êµ¬ë¶„)</label>
      <input type="text" id="predictNumbersInput" placeholder="ì˜ˆ: 1, 7, 15, 23, 35, 42" style="width:100%;padding:12px;border:none;border-radius:10px;background:var(--card2);color:var(--text);font-size:14px">
    </div>
    <div style="margin-bottom:12px">
      <label style="font-size:11px;color:var(--text2);display:block;margin-bottom:4px">ë©”ëª¨ (ì„ íƒ)</label>
      <input type="text" id="predictMemoInput" placeholder="ì˜ˆ: AI ì˜ˆì¸¡, ìƒì¼ ë²ˆí˜¸ ë“±" style="width:100%;padding:12px;border:none;border-radius:10px;background:var(--card2);color:var(--text);font-size:14px">
    </div>
    <div class="modal-buttons">
      <button class="btn btn-outline" onclick="closePredictModal()">ì·¨ì†Œ</button>
      <button class="btn btn-primary" onclick="savePrediction()">ì €ì¥</button>
    </div>
  </div>
</div>

<!-- í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ -->
<nav class="bottom-nav">
  <button class="nav-item active" onclick="showSection('home',this)"><span>ğŸ </span>í™ˆ</button>
  <button class="nav-item" onclick="showSection('predict',this)"><span>ğŸ”®</span>ì˜ˆì¸¡</button>
  <button class="nav-item" onclick="showSection('mypredict',this)"><span>ğŸ“</span>ë‚´ ì˜ˆì¸¡</button>
  <button class="nav-item" onclick="showSection('stats',this)"><span>ğŸ“Š</span>í†µê³„</button>
  <button class="nav-item" onclick="showSection('settings',this)"><span>âš™ï¸</span>ì„¤ì •</button>
</nav>

<script>
// ì „ì—­ ë³€ìˆ˜
let lottoData=[], currentIndex=0, checkNumbers=new Set(), excludedNumbers=new Set(), requiredNumbers=new Set(), wheelNumbers=new Set();
let predictCount=3, numStats=[], predictOptions=new Set();
let numSort={key:'num',asc:true}, numFilter='all', pairData={};
let myPredictions=[]; // ë‚´ ì˜ˆì¸¡ ì €ì¥
let statStartRound=1, statEndRound=9999; // í†µê³„ ê¸°ê°„ ì„¤ì •
let freqRecommendNums=[]; // ë¹ˆë„ ê¸°ë°˜ ì¶”ì²œ ë²ˆí˜¸

// ì´ˆê¸°í™”
async function init(){
  try{
    const res=await fetch('lotto_data.json');
    if(!res.ok) throw new Error('ë°ì´í„° ì—†ìŒ');
    lottoData=await res.json();
    lottoData.sort((a,b)=>b.round-a.round);
    document.getElementById('loading').style.display='none';
    document.getElementById('sec-home').classList.add('active');
    initAllGrids();
    initStatRangeSelects();
    calculateAllStats();
    renderCurrentRound();
    renderAllStats();
    updateDataStatus();
    initPairSelect();
    loadMyPredictions();
  }catch(e){
    document.getElementById('loading').innerHTML='<p style="color:var(--danger)">âŒ '+e.message+'</p><button class="btn btn-primary" style="margin-top:16px" onclick="location.reload()">ë‹¤ì‹œ ì‹œë„</button>';
  }
}

// ìœ í‹¸ë¦¬í‹°
function getBallClass(n){return n<=10?'b1':n<=20?'b2':n<=30?'b3':n<=40?'b4':'b5'}
function createBall(n,size='',extra=''){return '<div class="ball '+size+' '+getBallClass(n)+' '+extra+'">'+n+'</div>'}
function createBalls(nums,bonus=null,size='sm',matched=[]){
  let h=nums.map(n=>createBall(n,size,matched.includes(n)?'matched':'')).join('');
  if(bonus!=null) h+='<span class="plus">+</span>'+createBall(bonus,size,matched.includes(bonus)?'matched bonus':'bonus');
  return h;
}
function formatMoney(a){if(!a)return'-';if(a>=1e8)return(a/1e8).toFixed(1)+'ì–µ';if(a>=1e4)return Math.floor(a/1e4).toLocaleString()+'ë§Œ';return a.toLocaleString()}
function formatDate(d){return d&&d.length===8?d.slice(0,4)+'.'+d.slice(4,6)+'.'+d.slice(6,8):''}
function calcNetPrize(a){if(!a)return 0;return a>3e8?a-(3e8*.22)-((a-3e8)*.33):a*.78}

// ê³µí†µ: ìƒ‰ìƒëŒ€ë³„ ì¹´ìš´íŠ¸ ê³„ì‚°
function getColorDistribution(numbers){
  const dist={'1-10':0,'11-20':0,'21-30':0,'31-40':0,'41-45':0};
  numbers.forEach(n=>{
    if(n<=10)dist['1-10']++;
    else if(n<=20)dist['11-20']++;
    else if(n<=30)dist['21-30']++;
    else if(n<=40)dist['31-40']++;
    else dist['41-45']++;
  });
  return dist;
}

// ê³µí†µ: APIë¡œ ë¡œë˜ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
async function fetchLottoRound(round){
  const apiUrl='https://www.dhlottery.co.kr/common.do?method=getLottoNumber&drwNo='+round;
  const res=await fetch(apiUrl);
  const data=await res.json();
  if(data.returnValue!=='success')return null;
  return{
    round:data.drwNo,
    date:data.drwNoDate.replace(/-/g,''),
    numbers:[data.drwtNo1,data.drwtNo2,data.drwtNo3,data.drwtNo4,data.drwtNo5,data.drwtNo6],
    bonus:data.bnusNo,
    rank1:{winners:data.firstPrzwnerCo||0,prize:data.firstWinamnt||0,totalPrize:data.firstAccumamnt||0},
    rank2:{winners:0,prize:0,totalPrize:0},
    rank3:{winners:0,prize:0,totalPrize:0},
    rank4:{winners:0,prize:0,totalPrize:0},
    rank5:{winners:0,prize:0,totalPrize:0},
    totalWinners:0,
    totalSales:data.totSellamnt||0,
    gameNo:0
  };
}

// ê³µí†µ: ìƒˆ íšŒì°¨ ìˆ˜ì§‘ í›„ ë°ì´í„° ê°±ì‹ 
function refreshAfterCollect(newData){
  newData.forEach(d=>{
    if(!lottoData.find(x=>x.round===d.round)){
      lottoData.unshift(d);
    }
  });
  lottoData.sort((a,b)=>b.round-a.round);
  currentIndex=0;
  calculateAllStats();
  renderCurrentRound();
  renderAllStats();
  updateDataStatus();
}

// ì„¹ì…˜/íƒ­
function showSection(id,el){
  document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active'));
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('sec-'+id).classList.add('active');
  window.scrollTo(0,0);
}
function showStatTab(id,el){
  document.querySelectorAll('#sec-stats .tab').forEach(t=>t.classList.remove('active'));
  document.querySelectorAll('.stat-content').forEach(c=>c.style.display='none');
  el.classList.add('active');
  document.getElementById('stat-'+id).style.display='block';
}

// ì•„ì½”ë””ì–¸
function toggleAccordion(id){document.getElementById(id).classList.toggle('open')}

// ë²ˆí˜¸ ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
function initAllGrids(){
  ['checkGrid','excludeGrid','requireGrid','wheelGrid'].forEach(gid=>{
    const g=document.getElementById(gid);g.innerHTML='';
    for(let i=1;i<=45;i++){
      const b=document.createElement('button');
      b.className='number-btn '+getBallClass(i);
      b.textContent=i;
      b.onclick=()=>toggleGridNumber(gid,i,b);
      g.appendChild(b);
    }
  });
}
function toggleGridNumber(gid,num,btn){
  if(gid==='checkGrid'){
    if(checkNumbers.has(num)){checkNumbers.delete(num);btn.classList.remove('selected')}
    else if(checkNumbers.size<6){checkNumbers.add(num);btn.classList.add('selected')}
    updateMyNumDisplay();
  }else if(gid==='excludeGrid'){
    if(excludedNumbers.has(num)){excludedNumbers.delete(num);btn.classList.remove('excluded')}
    else{excludedNumbers.add(num);requiredNumbers.delete(num);btn.classList.add('excluded');
      document.querySelectorAll('#requireGrid .number-btn')[num-1].classList.remove('required')}
    updateExcludeDisplay();
  }else if(gid==='requireGrid'){
    if(requiredNumbers.has(num)){requiredNumbers.delete(num);btn.classList.remove('required')}
    else if(requiredNumbers.size<5&&!excludedNumbers.has(num)){requiredNumbers.add(num);btn.classList.add('required')}
    updateRequireDisplay();
  }else if(gid==='wheelGrid'){
    if(wheelNumbers.has(num)){wheelNumbers.delete(num);btn.classList.remove('selected')}
    else if(wheelNumbers.size<15){wheelNumbers.add(num);btn.classList.add('selected')}
    updateWheelDisplay();
  }
}
function updateMyNumDisplay(){
  const nums=[...checkNumbers].sort((a,b)=>a-b);
  document.getElementById('myNumDisplay').innerHTML=nums.length?nums.map(n=>createBall(n,'xs')).join(''):'';
}
function updateExcludeDisplay(){
  const nums=[...excludedNumbers].sort((a,b)=>a-b);
  document.getElementById('excludeDisplay').textContent=nums.length?nums.join(', '):'';
}
function updateRequireDisplay(){
  const nums=[...requiredNumbers].sort((a,b)=>a-b);
  document.getElementById('requireDisplay').textContent=nums.length?nums.join(', '):'';
}
function updateWheelDisplay(){
  const nums=[...wheelNumbers].sort((a,b)=>a-b);
  document.getElementById('wheelDisplay').textContent=nums.length?nums.join(', ')+'('+nums.length+'ê°œ)':'';
}
function clearCheck(){
  checkNumbers.clear();
  document.querySelectorAll('#checkGrid .number-btn').forEach(b=>b.classList.remove('selected'));
  updateMyNumDisplay();
  document.getElementById('checkResult').innerHTML='';
}

// íšŒì°¨ ë„¤ë¹„ê²Œì´ì…˜
function renderCurrentRound(){
  const item=lottoData[currentIndex];if(!item)return;
  document.getElementById('currentRound').textContent=item.round+'íšŒ';
  document.getElementById('currentDate').textContent=formatDate(item.date);
  
  // ë‚´ ë²ˆí˜¸ì™€ ë¹„êµí•˜ì—¬ ì¼ì¹˜ í‘œì‹œ
  const matched=checkNumbers.size===6?[...checkNumbers].filter(n=>item.numbers.includes(n)):[];
  const bonusMatch=checkNumbers.has(item.bonus);
  document.getElementById('currentBalls').innerHTML=createBalls(item.numbers,item.bonus,'',matched);
  
  // ë‹¹ì²¨ê¸ˆ í‘œì‹œ
  const p1=item.rank1?.prize||0,w1=item.rank1?.winners||0;
  document.getElementById('prize1').textContent=formatMoney(p1)+'ì›';
  document.getElementById('prize1Net').textContent='ì‹¤ìˆ˜ë ¹: '+formatMoney(calcNetPrize(p1))+'ì›';
  document.getElementById('prize1Info').textContent=w1+'ëª… ë‹¹ì²¨';
  
  const p2=item.rank2?.prize||0,w2=item.rank2?.winners||0;
  document.getElementById('prize2').textContent=formatMoney(p2)+'ì›';
  document.getElementById('prize2Info').textContent=w2+'ëª…';
  
  const p3=item.rank3?.prize||0,w3=item.rank3?.winners||0;
  document.getElementById('prize3').textContent=formatMoney(p3)+'ì›';
  document.getElementById('prize3Info').textContent=w3+'ëª…';
  
  document.getElementById('totalSales').textContent=formatMoney(item.totalSales)+'ì›';
  document.getElementById('totalWinners').textContent=(item.totalWinners||0).toLocaleString()+'ëª…';
  
  document.getElementById('prevBtn').disabled=currentIndex>=lottoData.length-1;

  // ìµœì‹  íšŒì°¨ì¼ ë•Œ nextBtnì„ ìˆ˜ë™ ìˆ˜ì§‘ ë²„íŠ¼(â­•)ìœ¼ë¡œ ë³€ê²½
  const nextBtn=document.getElementById('nextBtn');
  if(currentIndex<=0){
    nextBtn.textContent='â­•';
    nextBtn.disabled=false;
    nextBtn.title='ìƒˆ íšŒì°¨ ìˆ˜ì§‘';
  }else{
    nextBtn.textContent='â–¶';
    nextBtn.disabled=false;
    nextBtn.title='ë‹¤ìŒ íšŒì°¨';
  }
  
  // ë‚´ ë²ˆí˜¸ ì…ë ¥ë˜ì–´ ìˆìœ¼ë©´ ìë™ ë¹„êµ
  if(checkNumbers.size===6) autoCompare();

  // ì˜ˆì¸¡ ì¡°ê±´ ì •í•©ì„± ì²´í¬
  renderValidityCheck(item.numbers);
}
function prevRound(){if(currentIndex<lottoData.length-1){currentIndex++;renderCurrentRound()}}
function nextRound(){if(currentIndex>0){currentIndex--;renderCurrentRound()}}

// ì˜ˆì¸¡ ì¡°ê±´ ì •í•©ì„± ì²´í¬ ë Œë”ë§ (analyzeNumbersFull ì‚¬ìš©)
function renderValidityCheck(numbers){
  if(!numbers||numbers.length!==6)return;

  const analysis=analyzeNumbersFull(numbers);

  const checks=[
    {name:'í™€ì§ ê· í˜•',value:analysis.oddEven,detail:analysis.oddCount+':'+(6-analysis.oddCount)},
    {name:'ê³ ì € ê· í˜•',value:analysis.highLow,detail:analysis.lowCount+':'+(6-analysis.lowCount)},
    {name:'ì´í•© 100-175',value:analysis.sumInRange,detail:'í•©:'+analysis.sum},
    {name:'ì—°ì†ë²ˆí˜¸ ì—†ìŒ',value:analysis.noConsec,detail:analysis.hasConsec?'ìˆìŒ':'ì—†ìŒ'},
    {name:'ìƒ‰ìƒ ê· í˜•',value:analysis.colorBalance,detail:'ìµœëŒ€'+analysis.maxColorCount+'ê°œ'},
    {name:'ëìˆ˜ ë¶„ì‚°',value:analysis.endNumBalance,detail:analysis.endNumCount+'ì¢…ë¥˜'},
    {name:'HOT ë²ˆí˜¸',value:analysis.hasHot,detail:analysis.hasHot?'í¬í•¨':'ë¯¸í¬í•¨'},
    {name:'COLD ë²ˆí˜¸',value:analysis.hasCold,detail:analysis.hasCold?'í¬í•¨':'ë¯¸í¬í•¨'},
    {name:'ë¯¸ì¶œí˜„ ë²ˆí˜¸',value:analysis.hasLongAbsent,detail:analysis.hasLongAbsent?'í¬í•¨':'ë¯¸í¬í•¨'},
    {name:'ìµœê·¼ íŠ¸ë Œë“œ',value:analysis.hasRecentTrend,detail:analysis.hasRecentTrend?'í¬í•¨':'ë¯¸í¬í•¨'}
  ];

  const html=checks.map(c=>{
    const icon=c.value?'<span style="color:var(--success)">â­•</span>':'<span style="color:var(--danger)">âŒ</span>';
    return '<div style="display:flex;justify-content:space-between;align-items:center;padding:4px 8px;background:var(--card2);border:1px solid var(--border);border-radius:6px">'+
      '<span style="color:var(--text)">'+c.name+'</span>'+
      '<span>'+icon+' <span style="color:var(--text2);font-size:10px">'+c.detail+'</span></span></div>';
  }).join('');

  document.getElementById('validityCheck').innerHTML=html;
}
function nextOrCollect(){
  if(currentIndex<=0){
    // ìµœì‹  íšŒì°¨ë©´ ìˆ˜ë™ ìˆ˜ì§‘ ì‹¤í–‰
    manualCollectFromMain();
  }else{
    nextRound();
  }
}
function openRoundModal(){document.getElementById('roundModal').classList.add('active');document.getElementById('roundInput').value='';document.getElementById('roundInput').focus()}
function closeRoundModal(){document.getElementById('roundModal').classList.remove('active')}
function goToRound(){
  const r=parseInt(document.getElementById('roundInput').value);
  const idx=lottoData.findIndex(d=>d.round===r);
  if(idx!==-1){currentIndex=idx;renderCurrentRound();closeRoundModal()}
  else alert('í•´ë‹¹ íšŒì°¨ê°€ ì—†ìŠµë‹ˆë‹¤');
}
document.getElementById('roundModal').onclick=function(e){if(e.target===this)closeRoundModal()};
document.getElementById('roundInput').onkeypress=function(e){if(e.key==='Enter')goToRound()};

// ë‹¹ì²¨ í™•ì¸
function checkMyNumbers(){
  if(checkNumbers.size!==6){
    document.getElementById('checkResult').innerHTML='<div class="alert alert-danger">6ê°œ ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>';
    return;
  }
  autoCompare();
}
function autoCompare(){
  const item=lottoData[currentIndex];
  const my=[...checkNumbers],win=item.numbers,bonus=item.bonus;
  const matched=my.filter(n=>win.includes(n)),bm=my.includes(bonus);
  
  let rank='ë‚™ì²¨',prize=0,isWin=false;
  if(matched.length===6){rank='ğŸ¥‡ 1ë“±';prize=item.rank1?.prize||0;isWin=true}
  else if(matched.length===5&&bm){rank='ğŸ¥ˆ 2ë“±';prize=item.rank2?.prize||0;isWin=true}
  else if(matched.length===5){rank='ğŸ¥‰ 3ë“±';prize=item.rank3?.prize||0;isWin=true}
  else if(matched.length===4){rank='4ë“±';prize=50000;isWin=true}
  else if(matched.length===3){rank='5ë“±';prize=5000;isWin=true}
  
  let html='<div class="check-result"><div class="check-rank '+(isWin?'win':'lose')+'">'+rank+'</div>';
  if(isWin&&prize>5000) html+='<div style="font-size:18px;font-weight:700;margin:8px 0">'+formatMoney(prize)+'ì›</div><div style="color:var(--success);font-size:12px">ì‹¤ìˆ˜ë ¹: '+formatMoney(calcNetPrize(prize))+'ì›</div>';
  else if(isWin) html+='<div style="font-size:16px;margin:8px 0">'+prize.toLocaleString()+'ì›</div>';
  html+='<div style="color:var(--text2);font-size:12px;margin-top:8px">'+matched.length+'ê°œ ì¼ì¹˜'+(bm?' + ë³´ë„ˆìŠ¤':'')+'</div></div>';
  
  document.getElementById('checkResult').innerHTML=html;
  renderCurrentRound(); // ì¼ì¹˜ ë²ˆí˜¸ í‘œì‹œ ê°±ì‹ 
}

// í†µê³„ ê³„ì‚°
function calculateAllStats(){
  numStats=[];
  const freq={},lastSeen={},pairs={};
  for(let i=1;i<=45;i++){freq[i]=0;lastSeen[i]=lottoData.length;pairs[i]={}}
  
  lottoData.forEach((item,idx)=>{
    item.numbers.forEach(n=>{
      freq[n]++;
      if(idx<lastSeen[n])lastSeen[n]=idx;
      // ê¶í•© ê³„ì‚°
      item.numbers.forEach(m=>{if(n!==m){pairs[n][m]=(pairs[n][m]||0)+1}});
    });
  });
  
  const total=lottoData.length;
  const vals=Object.values(freq);
  const mean=vals.reduce((a,b)=>a+b,0)/45;
  const std=Math.sqrt(vals.reduce((s,v)=>s+Math.pow(v-mean,2),0)/45);
  
  for(let i=1;i<=45;i++){
    numStats.push({
      num:i,
      count:freq[i],
      percent:(freq[i]/(total*6)*100).toFixed(2),
      last:lastSeen[i],
      zscore:((freq[i]-mean)/std).toFixed(2)
    });
  }
  
  pairData=pairs;
  window.statMean=mean;
  window.statStd=std;
}

// ë²ˆí˜¸ë³„ í†µê³„ ë Œë”ë§ (ê¸°ê°„ í•„í„° ì ìš©)
function renderNumTable(){
  const filtered=getFilteredData();
  if(filtered.length===0){
    document.getElementById('numTableBody').innerHTML='<tr><td colspan="6" style="text-align:center;color:var(--text2)">ë°ì´í„° ì—†ìŒ</td></tr>';
    return;
  }

  // ê¸°ê°„ë³„ í†µê³„ ê³„ì‚°
  const freq={},lastSeen={};
  for(let i=1;i<=45;i++){freq[i]=0;lastSeen[i]=filtered.length}

  filtered.forEach((item,idx)=>{
    item.numbers.forEach(n=>{
      freq[n]++;
      if(idx<lastSeen[n])lastSeen[n]=idx;
    });
  });

  const total=filtered.length;
  const vals=Object.values(freq);
  const mean=vals.reduce((a,b)=>a+b,0)/45;
  const std=Math.sqrt(vals.reduce((s,v)=>s+Math.pow(v-mean,2),0)/45)||1;

  let data=[];
  for(let i=1;i<=45;i++){
    data.push({
      num:i,
      count:freq[i],
      percent:(freq[i]/(total*6)*100).toFixed(2),
      last:lastSeen[i],
      zscore:((freq[i]-mean)/std).toFixed(2)
    });
  }

  if(numFilter==='1-10')data=data.filter(d=>d.num<=10);
  else if(numFilter==='11-20')data=data.filter(d=>d.num>10&&d.num<=20);
  else if(numFilter==='21-30')data=data.filter(d=>d.num>20&&d.num<=30);
  else if(numFilter==='31-40')data=data.filter(d=>d.num>30&&d.num<=40);
  else if(numFilter==='41-45')data=data.filter(d=>d.num>40);
  else if(numFilter==='hot')data=data.filter(d=>parseFloat(d.zscore)>1.5);
  else if(numFilter==='cold')data=data.filter(d=>parseFloat(d.zscore)<-1.5);

  data.sort((a,b)=>{
    let va=a[numSort.key],vb=b[numSort.key];
    if(typeof va==='string'){va=parseFloat(va);vb=parseFloat(vb)}
    return numSort.asc?va-vb:vb-va;
  });

  document.getElementById('numTableBody').innerHTML=data.map(d=>{
    const z=parseFloat(d.zscore);
    let status='',sc='var(--text2)';
    if(z>1.5){status='ğŸ”¥';sc='var(--danger)'}
    else if(z<-1.5){status='â„ï¸';sc='#4dabf7'}
    return '<tr><td>'+createBall(d.num,'xs')+'</td><td>'+d.count+'</td><td>'+d.percent+'%</td><td>'+(d.last===0?'ìµœê·¼':d.last+'íšŒì „')+'</td><td style="color:'+(z>0?'var(--danger)':'#4dabf7')+'">'+d.zscore+'</td><td style="color:'+sc+'">'+status+'</td></tr>';
  }).join('');
}
function sortNum(key){if(numSort.key===key)numSort.asc=!numSort.asc;else{numSort.key=key;numSort.asc=true}renderNumTable()}
function filterNum(f,el){numFilter=f;document.querySelectorAll('#stat-number .filter-chip').forEach(c=>c.classList.remove('active'));el.classList.add('active');renderNumTable()}

// ê¶í•© ë²ˆí˜¸
function initPairSelect(){
  const sel=document.getElementById('pairSelect');
  for(let i=1;i<=45;i++) sel.innerHTML+='<option value="'+i+'">'+i+'</option>';
}
function showPairNumbers(){
  const num=parseInt(document.getElementById('pairSelect').value);
  if(!num){document.getElementById('pairResult').innerHTML='';return}
  
  const pairs=pairData[num];
  const sorted=Object.entries(pairs).sort((a,b)=>b[1]-a[1]).slice(0,6);
  
  document.getElementById('pairResult').innerHTML='<div class="pair-grid">'+sorted.map(([n,c])=>'<div class="pair-item">'+createBall(parseInt(n),'xs')+'<div style="margin-top:4px;color:var(--text2)">'+c+'íšŒ</div></div>').join('')+'</div>';
}

// íšŒì°¨ë³„ í†µê³„ ë Œë”ë§ (ê¸°ê°„ í•„í„° ì ìš©)
function renderRoundStats(){
  const filtered=getFilteredData();
  const total=filtered.length;

  if(total===0){
    ['oddEvenBody','highLowBody','endNumBody','colorBody'].forEach(id=>{
      document.getElementById(id).innerHTML='<tr><td colspan="3" style="text-align:center;color:var(--text2)">ë°ì´í„° ì—†ìŒ</td></tr>';
    });
    ['sumStats','consecStats','carryStats','gapStats'].forEach(id=>{
      document.getElementById(id).innerHTML='<div style="text-align:center;color:var(--text2)">ë°ì´í„° ì—†ìŒ</div>';
    });
    return;
  }

  const oe=[0,0,0,0,0,0,0],hl=[0,0,0,0,0,0,0],endNums={},colors={'1-10':0,'11-20':0,'21-30':0,'31-40':0,'41-45':0};
  let sums=[],consec=0,acSum=0,carryCount=[0,0,0,0,0,0,0],gapSum=0,gapCnt=0;
  for(let i=0;i<=9;i++)endNums[i]=0;

  filtered.forEach((item,idx)=>{
    const nums=item.numbers;
    const odd=nums.filter(n=>n%2===1).length;
    const low=nums.filter(n=>n<=22).length;
    oe[odd]++;hl[low]++;

    const sum=nums.reduce((a,b)=>a+b,0);
    sums.push(sum);

    // ëìˆ˜ í†µê³„
    nums.forEach(n=>endNums[n%10]++);

    // ìƒ‰ìƒ í†µê³„ (getColorDistribution í™œìš©)
    const colorDist=getColorDistribution(nums);
    Object.keys(colors).forEach(k=>colors[k]+=colorDist[k]);

    const sorted=[...nums].sort((a,b)=>a-b);
    for(let i=0;i<sorted.length-1;i++){
      if(sorted[i+1]-sorted[i]===1)consec++;
      gapSum+=sorted[i+1]-sorted[i];
      gapCnt++;
    }
    
    const diffs=new Set();
    for(let i=0;i<nums.length;i++)for(let j=i+1;j<nums.length;j++)diffs.add(Math.abs(nums[j]-nums[i]));
    acSum+=diffs.size-5;
    
    // ì´ì›” ë¶„ì„
    if(idx<filtered.length-1){
      const prevNums=filtered[idx+1].numbers;
      const carry=nums.filter(n=>prevNums.includes(n)).length;
      carryCount[carry]++;
    }
  });
  
  // í™€ì§
  document.getElementById('oddEvenBody').innerHTML=oe.map((v,i)=>'<tr><td>'+i+':'+(6-i)+'</td><td>'+v+'</td><td>'+(v/total*100).toFixed(1)+'%</td></tr>').join('');
  
  // ê³ ì €
  document.getElementById('highLowBody').innerHTML=hl.map((v,i)=>'<tr><td>'+i+':'+(6-i)+'</td><td>'+v+'</td><td>'+(v/total*100).toFixed(1)+'%</td></tr>').join('');
  
  // ì´í•©
  const avgSum=(sums.reduce((a,b)=>a+b,0)/total).toFixed(1);
  const minSum=Math.min(...sums),maxSum=Math.max(...sums);
  const oddSum=sums.filter(s=>s%2===1).length;
  document.getElementById('sumStats').innerHTML='<div class="info-row"><span>í‰ê· </span><span>'+avgSum+'</span></div><div class="info-row"><span>ë²”ìœ„</span><span>'+minSum+' ~ '+maxSum+'</span></div><div class="info-row"><span>í™€ìˆ˜ í•©ê³„</span><span>'+oddSum+'íšŒ ('+(oddSum/total*100).toFixed(1)+'%)</span></div><div class="info-row"><span>ì§ìˆ˜ í•©ê³„</span><span>'+(total-oddSum)+'íšŒ</span></div>';
  
  // ì—°ì†/AC
  const avgAC=(acSum/total).toFixed(2);
  const avgGap=(gapSum/gapCnt).toFixed(1);
  document.getElementById('consecStats').innerHTML='<div class="info-row"><span>ì—°ì†ë²ˆí˜¸ ìŒ</span><span>ì´ '+consec+'ìŒ (í‰ê·  '+(consec/total).toFixed(2)+'/íšŒì°¨)</span></div><div class="info-row"><span>í‰ê·  ACê°’</span><span>'+avgAC+' (0~10)</span></div><div class="info-row"><span>í‰ê·  ë²ˆí˜¸ê°„ê²©</span><span>'+avgGap+'</span></div>';
  
  // ì´ì›”
  document.getElementById('carryStats').innerHTML=carryCount.map((v,i)=>'<div class="info-row"><span>'+i+'ê°œ ì´ì›”</span><span>'+v+'íšŒ ('+(v/(total-1)*100).toFixed(1)+'%)</span></div>').join('');
  
  // ëìˆ˜
  const totalEndNums=Object.values(endNums).reduce((a,b)=>a+b,0);
  document.getElementById('endNumBody').innerHTML=Object.entries(endNums).map(([k,v])=>'<tr><td>'+k+'</td><td>'+v+'</td><td>'+(v/totalEndNums*100).toFixed(1)+'%</td></tr>').join('');
  
  // ê°„ê²©
  document.getElementById('gapStats').innerHTML='<div class="info-row"><span>í‰ê·  ê°„ê²©</span><span>'+avgGap+'</span></div><p style="font-size:11px;color:var(--text2);margin-top:8px">ë²ˆí˜¸ë¥¼ ì •ë ¬í–ˆì„ ë•Œ ì¸ì ‘ ë²ˆí˜¸ ê°„ì˜ ì°¨ì´</p>';
  
  // ìƒ‰ìƒ
  document.getElementById('colorBody').innerHTML=Object.entries(colors).map(([k,v])=>'<tr><td style="color:'+getColorByRange(k)+'">'+k+'</td><td>'+(v/total).toFixed(2)+'ê°œ</td><td>'+(v/(total*6)*100).toFixed(1)+'%</td></tr>').join('');
}
function getColorByRange(r){
  if(r==='1-10')return'#ffd700';if(r==='11-20')return'#4dabf7';if(r==='21-30')return'#ff6b6b';if(r==='31-40')return'#868e96';return'#51cf66';
}

function renderAllStats(){renderNumTable();renderRoundStats();renderFreqRecommend();renderConditionStats()}

// ========== í†µê³„ ê¸°ê°„ ì„¤ì • ==========
function initStatRangeSelects(){
  const startSel=document.getElementById('statStartRound');
  const endSel=document.getElementById('statEndRound');
  if(!startSel||!endSel||!lottoData.length)return;

  const minRound=lottoData[lottoData.length-1].round;
  const maxRound=lottoData[0].round;

  startSel.innerHTML='';
  endSel.innerHTML='';

  for(let r=maxRound;r>=minRound;r--){
    startSel.innerHTML+='<option value="'+r+'">'+r+'íšŒ</option>';
    endSel.innerHTML+='<option value="'+r+'">'+r+'íšŒ</option>';
  }

  startSel.value=minRound;
  endSel.value=maxRound;
  statStartRound=minRound;
  statEndRound=maxRound;
  updateStatRangeInfo();
}

function updateStatRange(){
  statStartRound=parseInt(document.getElementById('statStartRound').value);
  statEndRound=parseInt(document.getElementById('statEndRound').value);

  // ì‹œì‘ì´ ëë³´ë‹¤ í¬ë©´ êµí™˜
  if(statStartRound>statEndRound){
    [statStartRound,statEndRound]=[statEndRound,statStartRound];
    document.getElementById('statStartRound').value=statStartRound;
    document.getElementById('statEndRound').value=statEndRound;
  }

  updateStatRangeInfo();
  clearStatRangeButtons();
  renderAllStats();
}

function updateStatRangeInfo(){
  const count=lottoData.filter(d=>d.round>=statStartRound&&d.round<=statEndRound).length;
  document.getElementById('statRangeInfo').textContent='('+count+'íšŒì°¨)';
}

function clearStatRangeButtons(){
  document.querySelectorAll('#sec-stats .card:first-child .filter-chip').forEach(b=>b.classList.remove('active'));
}

function setStatRange(preset,el){
  clearStatRangeButtons();
  if(el)el.classList.add('active');

  const maxRound=lottoData[0].round;
  const minRound=lottoData[lottoData.length-1].round;
  const now=new Date();

  switch(preset){
    case'recent10':
      statStartRound=Math.max(minRound,maxRound-9);
      statEndRound=maxRound;
      break;
    case'recent50':
      statStartRound=Math.max(minRound,maxRound-49);
      statEndRound=maxRound;
      break;
    case'month':
      // ì´ë²ˆë‹¬ (ëŒ€ëµ 4~5íšŒì°¨)
      const monthStart=new Date(now.getFullYear(),now.getMonth(),1);
      const monthData=lottoData.filter(d=>{
        const dd=d.date;
        if(!dd||dd.length!==8)return false;
        const dt=new Date(dd.slice(0,4),parseInt(dd.slice(4,6))-1,dd.slice(6,8));
        return dt>=monthStart;
      });
      if(monthData.length>0){
        statStartRound=monthData[monthData.length-1].round;
        statEndRound=monthData[0].round;
      }
      break;
    case'3months':
      const threeMonthsAgo=new Date(now.getFullYear(),now.getMonth()-3,1);
      const threeMonthData=lottoData.filter(d=>{
        const dd=d.date;
        if(!dd||dd.length!==8)return false;
        const dt=new Date(dd.slice(0,4),parseInt(dd.slice(4,6))-1,dd.slice(6,8));
        return dt>=threeMonthsAgo;
      });
      if(threeMonthData.length>0){
        statStartRound=threeMonthData[threeMonthData.length-1].round;
        statEndRound=threeMonthData[0].round;
      }
      break;
    case'year':
      const yearStart=new Date(now.getFullYear(),0,1);
      const yearData=lottoData.filter(d=>{
        const dd=d.date;
        if(!dd||dd.length!==8)return false;
        const dt=new Date(dd.slice(0,4),parseInt(dd.slice(4,6))-1,dd.slice(6,8));
        return dt>=yearStart;
      });
      if(yearData.length>0){
        statStartRound=yearData[yearData.length-1].round;
        statEndRound=yearData[0].round;
      }
      break;
    case'all':
    default:
      statStartRound=minRound;
      statEndRound=maxRound;
      break;
  }

  document.getElementById('statStartRound').value=statStartRound;
  document.getElementById('statEndRound').value=statEndRound;
  updateStatRangeInfo();
  renderAllStats();
}

// ê¸°ê°„ í•„í„°ë§ëœ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
function getFilteredData(){
  return lottoData.filter(d=>d.round>=statStartRound&&d.round<=statEndRound);
}

// ë¹ˆë„ ê¸°ë°˜ ë²ˆí˜¸ ì¶”ì²œ
function renderFreqRecommend(){
  const filtered=getFilteredData();
  if(filtered.length===0){
    document.getElementById('freqBalls').innerHTML='<span style="color:var(--text2)">ë°ì´í„° ì—†ìŒ</span>';
    document.getElementById('freqInfo').textContent='';
    freqRecommendNums=[];
    return;
  }

  // ë²ˆí˜¸ë³„ ë¹ˆë„ ê³„ì‚°
  const freq={};
  for(let i=1;i<=45;i++)freq[i]=0;
  filtered.forEach(d=>d.numbers.forEach(n=>freq[n]++));

  // ìƒìœ„ 10ê°œ ë²ˆí˜¸
  const sorted=Object.entries(freq).sort((a,b)=>b[1]-a[1]);
  const top10=sorted.slice(0,10).map(([n,c])=>({num:parseInt(n),count:c}));

  // ìƒìœ„ 6ê°œë¡œ ì¶”ì²œ
  freqRecommendNums=top10.slice(0,6).map(x=>x.num).sort((a,b)=>a-b);

  document.getElementById('freqBalls').innerHTML=createBalls(freqRecommendNums,null,'sm');
  document.getElementById('freqInfo').innerHTML='<div style="margin-top:8px">ìƒìœ„ ì¶œí˜„ ë²ˆí˜¸: '+top10.map(x=>x.num+'('+x.count+'íšŒ)').join(', ')+'</div>';
}

function addFreqToPredict(){
  if(freqRecommendNums.length!==6){
    alert('ì¶”ì²œ ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤');
    return;
  }
  const nextRound=(lottoData[0]?.round||0)+1;
  document.getElementById('predictEditId').value='';
  document.getElementById('predictRoundInput').value=nextRound;
  document.getElementById('predictNumbersInput').value=freqRecommendNums.join(', ');
  document.getElementById('predictMemoInput').value='ë¹ˆë„ ê¸°ë°˜ ì¶”ì²œ ('+statStartRound+'~'+statEndRound+'íšŒ)';
  document.getElementById('predictModalTitle').textContent='ì˜ˆì¸¡ ì¶”ê°€';
  document.getElementById('predictModal').classList.add('active');
}

// ì¡°ê±´ë³„ ë‹¹ì²¨ ë¶„ì„
function renderConditionStats(){
  const filtered=getFilteredData();
  if(filtered.length===0){
    document.getElementById('conditionStats').innerHTML='<div style="text-align:center;color:var(--text2);padding:12px">ë°ì´í„° ì—†ìŒ</div>';
    return;
  }

  const conditions=[
    {name:'í™€ì§ ê· í˜• (3:3)',check:nums=>nums.filter(n=>n%2===1).length===3},
    {name:'ê³ ì € ê· í˜• (3:3)',check:nums=>nums.filter(n=>n<=22).length===3},
    {name:'ì´í•© 100-175',check:nums=>{const s=nums.reduce((a,b)=>a+b,0);return s>=100&&s<=175}},
    {name:'ì—°ì†ë²ˆí˜¸ ì—†ìŒ',check:nums=>{const sorted=[...nums].sort((a,b)=>a-b);for(let i=0;i<5;i++)if(sorted[i+1]-sorted[i]===1)return false;return true}},
    {name:'ìƒ‰ìƒ ê· í˜• (ìµœëŒ€2ê°œ)',check:nums=>{const d=getColorDistribution(nums);return Math.max(...Object.values(d))<=2}},
    {name:'ëìˆ˜ 4ì¢…ë¥˜ ì´ìƒ',check:nums=>new Set(nums.map(n=>n%10)).size>=4}
  ];

  let html='<div style="display:grid;gap:8px">';

  conditions.forEach(cond=>{
    let matchCount=0;
    filtered.forEach(d=>{
      if(cond.check(d.numbers))matchCount++;
    });
    const pct=(matchCount/filtered.length*100).toFixed(1);
    const barPct=Math.min(100,pct);

    html+='<div style="background:var(--card2);padding:10px 12px;border-radius:8px;border:1px solid var(--border)">';
    html+='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:6px">';
    html+='<span style="font-size:12px;color:var(--text)">'+cond.name+'</span>';
    html+='<span style="font-size:12px;font-weight:600;color:var(--primary)">'+matchCount+'íšŒ ('+pct+'%)</span>';
    html+='</div>';
    html+='<div style="height:6px;background:var(--border);border-radius:3px;overflow:hidden">';
    html+='<div style="width:'+barPct+'%;height:100%;background:var(--primary);border-radius:3px"></div>';
    html+='</div></div>';
  });

  html+='</div>';
  document.getElementById('conditionStats').innerHTML=html;
}

// ì˜ˆì¸¡ ì˜µì…˜
function toggleOption(el,opt){
  el.classList.toggle('checked');
  if(predictOptions.has(opt))predictOptions.delete(opt);
  else predictOptions.add(opt);
}

function adjustCount(d){predictCount=Math.max(1,Math.min(10,predictCount+d));document.getElementById('predictCount').textContent=predictCount}

function generatePrediction(){
  const results=[];
  const available=[];
  for(let i=1;i<=45;i++)if(!excludedNumbers.has(i))available.push(i);
  
  // HOT/COLD ë²ˆí˜¸ ë¯¸ë¦¬ ê³„ì‚°
  const hotNums=numStats.filter(d=>parseFloat(d.zscore)>1.5).map(d=>d.num);
  const coldNums=numStats.filter(d=>parseFloat(d.zscore)<-1.5).map(d=>d.num);
  const longAbsentNums=numStats.filter(d=>d.last>=10).sort((a,b)=>b.last-a.last).slice(0,10).map(d=>d.num);
  const recentFreq={};
  for(let i=1;i<=45;i++)recentFreq[i]=0;
  lottoData.slice(0,10).forEach(item=>item.numbers.forEach(n=>recentFreq[n]++));
  
  for(let set=0;set<predictCount;set++){
    let attempts=0,selected=null;
    
    while(attempts<100){
      attempts++;
      selected=[...requiredNumbers];
      const pool=available.filter(n=>!requiredNumbers.has(n));
      
      // ì˜µì…˜ì— ë”°ë¥¸ ê°€ì¤‘ì¹˜ ì ìš©
      let weights={};
      pool.forEach(n=>weights[n]=1);
      
      if(predictOptions.has('hot'))hotNums.forEach(n=>{if(weights[n])weights[n]+=2});
      if(predictOptions.has('cold'))coldNums.forEach(n=>{if(weights[n])weights[n]+=2});
      if(predictOptions.has('recentTrend'))pool.forEach(n=>weights[n]+=recentFreq[n]);
      if(predictOptions.has('longAbsent'))longAbsentNums.forEach(n=>{if(weights[n])weights[n]+=2});
      
      // ê°€ì¤‘ì¹˜ ê¸°ë°˜ ì„ íƒ
      while(selected.length<6&&pool.length>0){
        const totalWeight=pool.reduce((s,n)=>s+weights[n],0);
        let r=Math.random()*totalWeight,cumul=0,chosen=pool[0];
        for(const n of pool){cumul+=weights[n];if(r<=cumul){chosen=n;break}}
        selected.push(chosen);
        pool.splice(pool.indexOf(chosen),1);
      }
      
      selected.sort((a,b)=>a-b);

      // ì¡°ê±´ ê²€ì¦ (analyzeNumbersFull ì‚¬ìš©)
      const analysis=analyzeNumbersFull(selected);
      let valid=true;

      if(predictOptions.has('oddEven')&&!analysis.oddEven)valid=false;
      if(predictOptions.has('highLow')&&!analysis.highLow)valid=false;
      if(predictOptions.has('sumRange')&&!analysis.sumInRange)valid=false;
      if(predictOptions.has('noConsec')&&!analysis.noConsec)valid=false;
      if(predictOptions.has('colorBalance')&&!analysis.colorBalance)valid=false;
      if(predictOptions.has('endNumBalance')&&!analysis.endNumBalance)valid=false;

      if(valid)break;
    }
    
    if(selected&&selected.length===6)results.push(selected);
  }
  
  document.getElementById('predictResults').innerHTML=results.map((nums,i)=>{
    const sum=nums.reduce((a,b)=>a+b,0);
    const odd=nums.filter(n=>n%2===1).length;
    const numsStr=nums.join(',');
    return '<div class="predict-result"><div class="predict-index" style="display:flex;justify-content:space-between;align-items:center">'
      +'<span>'+(i+1)+'ë²ˆ <span style="color:var(--text2);font-size:10px">í•©:'+sum+' í™€:'+odd+'</span></span>'
      +'<button onclick="addPredictFromResult(\''+numsStr+'\')" style="padding:4px 8px;border:none;border-radius:6px;background:var(--primary);color:#fff;font-size:10px;cursor:pointer">â• ì¶”ê°€</button>'
      +'</div><div class="balls">'+createBalls(nums,null,'sm')+'</div></div>';
  }).join('')||'<div class="alert alert-danger">ì¡°ê±´ì— ë§ëŠ” ì¡°í•©ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div>';
}

// ì¶•ì†Œ ì‹œìŠ¤í…œ
function generateWheel(){
  if(wheelNumbers.size<6){
    document.getElementById('wheelResults').innerHTML='<div class="alert alert-danger">ìµœì†Œ 6ê°œ ë²ˆí˜¸ë¥¼ ì„ íƒí•˜ì„¸ìš”</div>';
    return;
  }
  if(wheelNumbers.size>12){
    document.getElementById('wheelResults').innerHTML='<div class="alert alert-danger">ìµœëŒ€ 12ê°œê¹Œì§€ ì„ íƒ ê°€ëŠ¥í•©ë‹ˆë‹¤ (ì¡°í•© ìˆ˜ ì œí•œ)</div>';
    return;
  }
  
  const nums=[...wheelNumbers].sort((a,b)=>a-b);
  const combos=[];
  
  function combine(start,combo){
    if(combo.length===6){combos.push([...combo]);return}
    for(let i=start;i<nums.length;i++){
      combo.push(nums[i]);
      combine(i+1,combo);
      combo.pop();
    }
  }
  combine(0,[]);
  
  document.getElementById('wheelResults').innerHTML='<div class="wheel-info">ì´ '+combos.length+'ê°œ ì¡°í•©</div><div class="wheel-result">'+combos.slice(0,50).map((c,i)=>'<div class="wheel-item">'+(i+1)+'. '+c.join(', ')+'</div>').join('')+(combos.length>50?'<div class="wheel-item" style="color:var(--text2)">... ì™¸ '+(combos.length-50)+'ê°œ</div>':'')+'</div>';
}

// ì„¤ì •
function updateDataStatus(){
  if(!lottoData.length){document.getElementById('dataStatus').innerHTML='ë°ì´í„° ì—†ìŒ';return}
  const first=lottoData[lottoData.length-1],last=lottoData[0];
  document.getElementById('dataStatus').innerHTML='<div class="info-row"><span>ì´ íšŒì°¨</span><span><strong>'+lottoData.length+'íšŒ</strong></span></div><div class="info-row"><span>ë²”ìœ„</span><span>'+first.round+'íšŒ ~ '+last.round+'íšŒ</span></div><div class="info-row"><span>ìµœì‹  ì¶”ì²¨ì¼</span><span>'+formatDate(last.date)+'</span></div>';
}
function exportData(){
  const b=new Blob([JSON.stringify(lottoData,null,2)],{type:'application/json'});
  const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download='lotto_data.json';a.click();
}

// ê³µí†µ ìˆ˜ì§‘ ë¡œì§ (ìµœëŒ€ 5íšŒì°¨ê¹Œì§€ ìƒˆ ë°ì´í„° ìˆ˜ì§‘)
async function collectNewRounds(onProgress){
  const currentLatest=lottoData.length?lottoData[0].round:0;
  let newRound=currentLatest+1;
  let newData=[];
  let checked=0;

  while(checked<5){
    if(onProgress)onProgress(newRound);
    try{
      const data=await fetchLottoRound(newRound);
      if(data){
        newData.push(data);
        newRound++;
        checked++;
      }else{
        break;
      }
    }catch(e){
      break;
    }
  }
  return{newData,currentLatest};
}

// ë©”ì¸ í™”ë©´ì—ì„œ ìˆ˜ë™ ìˆ˜ì§‘ (íšŒì°¨ ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ìš©)
async function manualCollectFromMain(){
  const nextBtn=document.getElementById('nextBtn');
  nextBtn.disabled=true;
  nextBtn.textContent='â³';

  try{
    const{newData,currentLatest}=await collectNewRounds();
    if(newData.length>0){
      refreshAfterCollect(newData);
      alert('âœ… '+newData.length+'ê°œ íšŒì°¨ ìˆ˜ì§‘ ì™„ë£Œ!\\n'+newData.map(d=>d.round+'íšŒ').join(', '));
    }else{
      alert('â„¹ï¸ ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.\\n(ìµœì‹ : '+currentLatest+'íšŒ)');
    }
  }catch(e){
    alert('âŒ ìˆ˜ì§‘ ì‹¤íŒ¨: '+e.message);
  }

  nextBtn.disabled=false;
  nextBtn.textContent='â­•';
}

// ìˆ˜ë™ ìˆ˜ì§‘ (ì„¤ì • íƒ­ìš©)
async function manualCollect(){
  const btn=document.getElementById('collectBtn');
  const status=document.getElementById('collectStatus');
  btn.disabled=true;
  btn.textContent='â³ ìˆ˜ì§‘ ì¤‘...';
  status.innerHTML='<span style="color:var(--primary)">ë™í–‰ë³µê¶Œ API í˜¸ì¶œ ì¤‘...</span>';

  try{
    const{newData,currentLatest}=await collectNewRounds(round=>{
      status.innerHTML='<span style="color:var(--primary)">'+round+'íšŒì°¨ í™•ì¸ ì¤‘...</span>';
    });

    if(newData.length>0){
      refreshAfterCollect(newData);
      status.innerHTML='<span style="color:var(--success)">âœ… '+newData.length+'ê°œ íšŒì°¨ ìˆ˜ì§‘ ì™„ë£Œ! ('+newData.map(d=>d.round+'íšŒ').join(', ')+')</span>';
    }else{
      status.innerHTML='<span style="color:var(--text2)">â„¹ï¸ ìƒˆë¡œìš´ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. (ìµœì‹ : '+currentLatest+'íšŒ)</span>';
    }
  }catch(e){
    status.innerHTML='<span style="color:var(--danger)">âŒ ìˆ˜ì§‘ ì‹¤íŒ¨: '+e.message+'</span>';
  }

  btn.disabled=false;
  btn.textContent='ğŸ“¡ ìˆ˜ë™ ìˆ˜ì§‘';
}

// ========== ë‚´ ì˜ˆì¸¡ ê´€ë¦¬ ==========
function loadMyPredictions(){
  try{
    const saved=localStorage.getItem('myLottoPredictions');
    myPredictions=saved?JSON.parse(saved):[];
  }catch(e){myPredictions=[];}
  updatePredictionResults();
  renderMyPredictions();
}

function saveMyPredictions(){
  localStorage.setItem('myLottoPredictions',JSON.stringify(myPredictions));
}

function updatePredictionResults(){
  // ëŒ€ê¸°ì¤‘ì¸ ì˜ˆì¸¡ì˜ ê²°ê³¼ í™•ì¸
  myPredictions.forEach(p=>{
    if(p.status==='pending'){
      const result=lottoData.find(d=>d.round===p.targetRound);
      if(result){
        const matched=p.numbers.filter(n=>result.numbers.includes(n));
        const bonusMatch=p.numbers.includes(result.bonus);
        p.status='completed';
        p.result={
          winNumbers:result.numbers,
          bonus:result.bonus,
          matched:matched,
          matchCount:matched.length,
          bonusMatch:bonusMatch,
          rank:getRank(matched.length,bonusMatch),
          prize:getPrize(matched.length,bonusMatch,result)
        };
      }
    }
  });
  saveMyPredictions();
}

function getRank(matchCount,bonusMatch){
  if(matchCount===6)return'1ë“±';
  if(matchCount===5&&bonusMatch)return'2ë“±';
  if(matchCount===5)return'3ë“±';
  if(matchCount===4)return'4ë“±';
  if(matchCount===3)return'5ë“±';
  return'ë‚™ì²¨';
}

function getPrize(matchCount,bonusMatch,result){
  if(matchCount===6)return result.rank1?.prize||0;
  if(matchCount===5&&bonusMatch)return result.rank2?.prize||0;
  if(matchCount===5)return result.rank3?.prize||0;
  if(matchCount===4)return 50000;
  if(matchCount===3)return 5000;
  return 0;
}

function renderMyPredictions(){
  const pending=myPredictions.filter(p=>p.status==='pending');
  const completed=myPredictions.filter(p=>p.status==='completed');
  const wins=completed.filter(p=>p.result?.matchCount>=3);

  // ìš”ì•½ ì—…ë°ì´íŠ¸
  document.getElementById('mpTotal').textContent=myPredictions.length;
  document.getElementById('mpWin').textContent=wins.length;
  document.getElementById('mpPending').textContent=pending.length;

  // ëŒ€ê¸°ì¤‘ ë Œë”ë§
  if(pending.length===0){
    document.getElementById('pendingPredicts').innerHTML='<div style="color:var(--text2);padding:12px;text-align:center">ëŒ€ê¸°ì¤‘ì¸ ì˜ˆì¸¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
  }else{
    document.getElementById('pendingPredicts').innerHTML=pending.map(p=>renderPredictCard(p,true)).join('');
  }

  // ì™„ë£Œëœ ë Œë”ë§
  if(completed.length===0){
    document.getElementById('completedPredicts').innerHTML='<div style="color:var(--text2);padding:12px;text-align:center">ì™„ë£Œëœ ì˜ˆì¸¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
  }else{
    document.getElementById('completedPredicts').innerHTML=completed.sort((a,b)=>b.targetRound-a.targetRound).map(p=>renderPredictCard(p,false)).join('');
  }

  // ì„±ê³¼ ë¶„ì„ & ë²ˆí˜¸ ì„ í˜¸ë„ ë Œë”ë§
  renderPerformanceAnalysis(completed);
  renderNumberPreference();
}

function renderPerformanceAnalysis(completed){
  const container=document.getElementById('performanceAnalysis');
  if(completed.length===0){
    container.innerHTML='<div style="color:var(--text2);font-size:12px;text-align:center;padding:12px">ì™„ë£Œëœ ì˜ˆì¸¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }

  // ë“±ìˆ˜ë³„ ë¶„í¬
  const rankDist={1:0,2:0,3:0,4:0,5:0,'ë‚™ì²¨':0};
  let totalPrize=0;
  let totalMatched=0;

  completed.forEach(p=>{
    if(p.result){
      if(p.result.rank==='1ë“±')rankDist[1]++;
      else if(p.result.rank==='2ë“±')rankDist[2]++;
      else if(p.result.rank==='3ë“±')rankDist[3]++;
      else if(p.result.rank==='4ë“±')rankDist[4]++;
      else if(p.result.rank==='5ë“±')rankDist[5]++;
      else rankDist['ë‚™ì²¨']++;
      totalPrize+=p.result.prize||0;
      totalMatched+=p.result.matchCount||0;
    }
  });

  const avgMatch=(totalMatched/completed.length).toFixed(2);
  const winRate=((completed.length-rankDist['ë‚™ì²¨'])/completed.length*100).toFixed(1);

  let html='<div style="display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:12px">';
  html+='<div style="text-align:center;padding:10px;background:var(--card2);border:1px solid var(--border);border-radius:8px"><div style="font-size:16px;font-weight:700;color:var(--success)">'+winRate+'%</div><div style="font-size:10px;color:var(--text2)">ë‹¹ì²¨ë¥ </div></div>';
  html+='<div style="text-align:center;padding:10px;background:var(--card2);border:1px solid var(--border);border-radius:8px"><div style="font-size:16px;font-weight:700;color:var(--primary)">'+avgMatch+'ê°œ</div><div style="font-size:10px;color:var(--text2)">í‰ê·  ì¼ì¹˜</div></div>';
  html+='<div style="text-align:center;padding:10px;background:var(--card2);border:1px solid var(--border);border-radius:8px"><div style="font-size:16px;font-weight:700;color:#b45309">'+formatMoney(totalPrize)+'ì›</div><div style="font-size:10px;color:var(--text2)">ì´ ë‹¹ì²¨ê¸ˆ</div></div>';
  html+='<div style="text-align:center;padding:10px;background:var(--card2);border:1px solid var(--border);border-radius:8px"><div style="font-size:16px;font-weight:700;color:var(--text)">'+completed.length+'íšŒ</div><div style="font-size:10px;color:var(--text2)">ì´ ì°¸ì—¬</div></div>';
  html+='</div>';

  // ë“±ìˆ˜ ë¶„í¬ ë°” ì°¨íŠ¸
  html+='<div style="font-size:11px;color:var(--text2);margin-bottom:8px">ë“±ìˆ˜ ë¶„í¬</div>';
  const maxRank=Math.max(...Object.values(rankDist),1);
  html+='<div style="display:flex;flex-direction:column;gap:4px">';
  [['1ë“±','#b45309',rankDist[1]],['2ë“±','#0969da',rankDist[2]],['3ë“±','#218bff',rankDist[3]],['4ë“±','#6e7781',rankDist[4]],['5ë“±','#2da44e',rankDist[5]],['ë‚™ì²¨','#cf222e',rankDist['ë‚™ì²¨']]].forEach(([label,color,cnt])=>{
    const pct=Math.max(cnt/maxRank*100,0);
    html+='<div style="display:flex;align-items:center;gap:8px;font-size:10px;color:var(--text)">';
    html+='<span style="width:35px">'+label+'</span>';
    html+='<div style="flex:1;height:16px;background:var(--card2);border:1px solid var(--border);border-radius:4px;overflow:hidden"><div style="width:'+pct+'%;height:100%;background:'+color+';border-radius:4px"></div></div>';
    html+='<span style="width:20px;text-align:right">'+cnt+'</span>';
    html+='</div>';
  });
  html+='</div>';

  container.innerHTML=html;
}

function renderNumberPreference(){
  const container=document.getElementById('numberPreference');
  if(myPredictions.length===0){
    container.innerHTML='<div style="color:var(--text2);font-size:12px;text-align:center;padding:12px">ì˜ˆì¸¡ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
    return;
  }

  // ë²ˆí˜¸ë³„ ì‚¬ìš© ë¹ˆë„
  const freq={};
  for(let i=1;i<=45;i++)freq[i]=0;
  myPredictions.forEach(p=>{
    p.numbers.forEach(n=>freq[n]++);
  });

  // ìƒìœ„ 10ê°œ
  const sorted=Object.entries(freq).sort((a,b)=>b[1]-a[1]);
  const top10=sorted.slice(0,10).filter(([n,c])=>c>0);
  const bottom10=sorted.slice(-10).filter(([n,c])=>c===0||c<sorted[0][1]).reverse().slice(0,5);

  let html='';

  // ìì£¼ ì‚¬ìš©í•œ ë²ˆí˜¸
  if(top10.length>0){
    html+='<div style="margin-bottom:12px"><div style="font-size:11px;color:var(--text2);margin-bottom:6px">ğŸ”¥ ìì£¼ ì„ íƒí•œ ë²ˆí˜¸</div>';
    html+='<div style="display:flex;flex-wrap:wrap;gap:6px">';
    top10.forEach(([n,c])=>{
      html+='<div style="display:flex;align-items:center;gap:4px">'+createBall(parseInt(n),'xs')+'<span style="font-size:10px;color:var(--text2)">'+c+'íšŒ</span></div>';
    });
    html+='</div></div>';
  }

  // ì•ˆ ì“´ ë²ˆí˜¸
  const unused=sorted.filter(([n,c])=>c===0);
  if(unused.length>0&&unused.length<=20){
    html+='<div><div style="font-size:11px;color:var(--text2);margin-bottom:6px">â„ï¸ ì•„ì§ ì•ˆ ì“´ ë²ˆí˜¸</div>';
    html+='<div style="display:flex;flex-wrap:wrap;gap:4px">';
    unused.forEach(([n])=>{
      html+=createBall(parseInt(n),'xs');
    });
    html+='</div></div>';
  }

  // ìƒ‰ìƒ ë¶„í¬ (getColorDistribution í™œìš©)
  html+='<div style="margin-top:12px"><div style="font-size:11px;color:var(--text2);margin-bottom:6px">ğŸ¨ ìƒ‰ìƒëŒ€ ì„ í˜¸ë„</div>';
  const colorCnt={'1-10':0,'11-20':0,'21-30':0,'31-40':0,'41-45':0};
  myPredictions.forEach(p=>{
    const dist=getColorDistribution(p.numbers);
    Object.keys(colorCnt).forEach(k=>colorCnt[k]+=dist[k]);
  });
  const totalNums=myPredictions.length*6;
  const colorData=[
    ['1-10','#f0b400',colorCnt['1-10']],
    ['11-20','#218bff',colorCnt['11-20']],
    ['21-30','#fa4549',colorCnt['21-30']],
    ['31-40','#6e7781',colorCnt['31-40']],
    ['41-45','#2da44e',colorCnt['41-45']]
  ];
  html+='<div style="display:flex;gap:4px;height:20px;border-radius:6px;overflow:hidden">';
  colorData.forEach(([range,color,cnt])=>{
    const pct=(cnt/totalNums*100).toFixed(0);
    if(cnt>0)html+='<div style="flex:'+cnt+';background:'+color+';display:flex;align-items:center;justify-content:center;font-size:9px;color:#000" title="'+range+': '+cnt+'íšŒ ('+pct+'%)">'+pct+'%</div>';
  });
  html+='</div>';
  html+='<div style="display:flex;justify-content:space-between;font-size:9px;color:var(--text2);margin-top:4px">';
  colorData.forEach(([range,color])=>{
    html+='<span style="color:'+color+'">'+range+'</span>';
  });
  html+='</div></div>';

  container.innerHTML=html;
}

function renderPredictCard(p,isPending){
  const analysis=analyzeNumbers(p.numbers);
  let html='<div style="background:var(--card);border:1px solid var(--border);border-radius:10px;padding:12px;margin-bottom:8px">';

  // í—¤ë”
  html+='<div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">';
  html+='<span style="font-weight:600;font-size:13px;color:var(--text)">'+p.targetRound+'íšŒì°¨</span>';
  html+='<div style="display:flex;gap:4px">';
  html+='<button onclick="editPrediction(\''+p.id+'\')" style="padding:4px 8px;border:none;border-radius:4px;background:var(--primary);color:#fff;font-size:10px;cursor:pointer">âœï¸</button>';
  html+='<button onclick="deletePrediction(\''+p.id+'\')" style="padding:4px 8px;border:none;border-radius:4px;background:var(--danger);color:#fff;font-size:10px;cursor:pointer">ğŸ—‘ï¸</button>';
  html+='</div></div>';

  // ë²ˆí˜¸
  html+='<div class="balls" style="margin-bottom:8px">'+createBalls(p.numbers,null,'xs',p.result?.matched||[])+'</div>';

  // ë©”ëª¨
  if(p.memo)html+='<div style="font-size:10px;color:var(--text2);margin-bottom:8px">ğŸ“ '+p.memo+'</div>';

  // ë¶„ì„ ìŠ¤ì½”ì–´ì¹´ë“œ
  html+='<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:4px;margin-bottom:8px;font-size:9px">';
  html+='<div style="text-align:center;padding:4px;background:var(--card2);border:1px solid var(--border);border-radius:4px"><div style="color:'+(analysis.oddEven?'var(--success)':'var(--danger)')+'">í™€ì§</div><div style="color:var(--text)">'+analysis.oddCount+':'+analysis.evenCount+'</div></div>';
  html+='<div style="text-align:center;padding:4px;background:var(--card2);border:1px solid var(--border);border-radius:4px"><div style="color:'+(analysis.highLow?'var(--success)':'var(--danger)')+'">ê³ ì €</div><div style="color:var(--text)">'+analysis.lowCount+':'+(6-analysis.lowCount)+'</div></div>';
  html+='<div style="text-align:center;padding:4px;background:var(--card2);border:1px solid var(--border);border-radius:4px"><div style="color:'+(analysis.sumInRange?'var(--success)':'var(--danger)')+'">ì´í•©</div><div style="color:var(--text)">'+analysis.sum+'</div></div>';
  html+='<div style="text-align:center;padding:4px;background:var(--card2);border:1px solid var(--border);border-radius:4px"><div style="color:'+(analysis.noConsec?'var(--success)':'var(--danger)')+'">ì—°ì†</div><div style="color:var(--text)">'+(analysis.hasConsec?'ìˆìŒ':'ì—†ìŒ')+'</div></div>';
  html+='</div>';

  // ê²°ê³¼ (ì™„ë£Œëœ ê²½ìš°)
  if(!isPending&&p.result){
    const isWin=p.result.matchCount>=3;
    html+='<div style="padding:8px;border-radius:6px;text-align:center;'+
      (isWin?'background:#f0fdf4;border:1px solid #bbf7d0':'background:#fef2f2;border:1px solid #fecaca')+'">';
    html+='<div style="font-size:14px;font-weight:700;'+(isWin?'color:var(--success)':'color:var(--danger)')+'">'+p.result.rank+'</div>';
    html+='<div style="font-size:11px;color:var(--text2)">'+p.result.matchCount+'ê°œ ì¼ì¹˜'+(p.result.bonusMatch?' + ë³´ë„ˆìŠ¤':'')+'</div>';
    if(p.result.prize>0)html+='<div style="font-size:12px;color:#b45309;margin-top:4px">'+formatMoney(p.result.prize)+'ì›</div>';
    html+='</div>';
  }else{
    // ë‚¨ì€ ë‚ ì§œ í‘œì‹œ
    const latestRound=lottoData[0]?.round||0;
    const remaining=p.targetRound-latestRound;
    if(remaining>0){
      html+='<div style="text-align:center;font-size:11px;color:var(--primary)">â³ ì•½ '+remaining+'ì£¼ í›„ ì¶”ì²¨</div>';
    }else{
      html+='<div style="text-align:center;font-size:11px;color:var(--warning)">â³ ê²°ê³¼ ëŒ€ê¸°ì¤‘...</div>';
    }
  }

  html+='</div>';
  return html;
}

// ë²ˆí˜¸ ë¶„ì„ (ê°„ë‹¨ ë²„ì „ - ì¹´ë“œìš©)
function analyzeNumbers(numbers){
  return analyzeNumbersFull(numbers);
}

// ë²ˆí˜¸ ë¶„ì„ (ì „ì²´ ë²„ì „ - ëª¨ë“  ì¡°ê±´ ì²´í¬)
function analyzeNumbersFull(numbers){
  const sorted=[...numbers].sort((a,b)=>a-b);
  const sum=sorted.reduce((a,b)=>a+b,0);
  const oddCount=sorted.filter(n=>n%2===1).length;
  const evenCount=6-oddCount;
  const lowCount=sorted.filter(n=>n<=22).length;

  // ì—°ì†ë²ˆí˜¸ ì²´í¬
  let hasConsec=false;
  for(let i=0;i<sorted.length-1;i++){
    if(sorted[i+1]-sorted[i]===1)hasConsec=true;
  }

  // ìƒ‰ìƒ ë¶„í¬
  const colorDist=getColorDistribution(numbers);
  const maxColorCount=Math.max(...Object.values(colorDist));

  // ëìˆ˜ ë¶„ì‚°
  const endNums=new Set(numbers.map(n=>n%10));
  const endNumCount=endNums.size;

  // HOT/COLD ë²ˆí˜¸ ì²´í¬
  let hasHot=false,hasCold=false,hasLongAbsent=false;
  if(numStats.length>0){
    const sortedStats=[...numStats].sort((a,b)=>b.count-a.count);
    const hotNums=sortedStats.slice(0,10).map(s=>s.num);
    const coldNums=sortedStats.slice(-10).map(s=>s.num);
    hasHot=numbers.some(n=>hotNums.includes(n));
    hasCold=numbers.some(n=>coldNums.includes(n));

    // ë¯¸ì¶œí˜„ ë²ˆí˜¸ (10íšŒ ì´ìƒ)
    const longAbsentNums=numStats.filter(s=>s.last>=10).map(s=>s.num);
    hasLongAbsent=numbers.some(n=>longAbsentNums.includes(n));
  }

  // ìµœê·¼ íŠ¸ë Œë“œ
  let hasRecentTrend=false;
  if(lottoData.length>=5){
    const recentNums=new Set();
    for(let i=0;i<5;i++){
      lottoData[i].numbers.forEach(n=>recentNums.add(n));
    }
    hasRecentTrend=numbers.some(n=>recentNums.has(n));
  }

  return{
    sum,oddCount,evenCount,lowCount,hasConsec,
    maxColorCount,endNumCount,
    hasHot,hasCold,hasLongAbsent,hasRecentTrend,
    // ì¡°ê±´ ì¶©ì¡± ì—¬ë¶€
    oddEven:oddCount===3,
    highLow:lowCount===3,
    sumInRange:sum>=100&&sum<=175,
    noConsec:!hasConsec,
    colorBalance:maxColorCount<=2,
    endNumBalance:endNumCount>=4
  };
}

// ì˜ˆì¸¡ ì¶”ê°€ (ì˜ˆì¸¡ í™”ë©´ì—ì„œ)
function addPredictFromResult(numsStr){
  const nums=numsStr.split(',').map(n=>parseInt(n));
  const nextRound=(lottoData[0]?.round||0)+1;
  document.getElementById('predictEditId').value='';
  document.getElementById('predictRoundInput').value=nextRound;
  document.getElementById('predictNumbersInput').value=nums.join(', ');
  document.getElementById('predictMemoInput').value='AI ì˜ˆì¸¡';
  document.getElementById('predictModalTitle').textContent='ì˜ˆì¸¡ ì¶”ê°€';
  document.getElementById('predictModal').classList.add('active');
}

function openAddPredictModal(){
  const nextRound=(lottoData[0]?.round||0)+1;
  document.getElementById('predictEditId').value='';
  document.getElementById('predictRoundInput').value=nextRound;
  document.getElementById('predictNumbersInput').value='';
  document.getElementById('predictMemoInput').value='';
  document.getElementById('predictModalTitle').textContent='ì˜ˆì¸¡ ì¶”ê°€';
  document.getElementById('predictModal').classList.add('active');
}

function closePredictModal(){
  document.getElementById('predictModal').classList.remove('active');
}

function savePrediction(){
  const editId=document.getElementById('predictEditId').value;
  const round=parseInt(document.getElementById('predictRoundInput').value);
  const numsStr=document.getElementById('predictNumbersInput').value;
  const memo=document.getElementById('predictMemoInput').value.trim();

  // ë²ˆí˜¸ íŒŒì‹±
  const nums=numsStr.split(/[,\s]+/).map(n=>parseInt(n.trim())).filter(n=>n>=1&&n<=45);
  if(nums.length!==6){
    alert('1~45 ì‚¬ì´ì˜ ë²ˆí˜¸ 6ê°œë¥¼ ì…ë ¥í•˜ì„¸ìš”');
    return;
  }
  if(new Set(nums).size!==6){
    alert('ì¤‘ë³µëœ ë²ˆí˜¸ê°€ ìˆìŠµë‹ˆë‹¤');
    return;
  }
  if(!round||round<1){
    alert('ì˜¬ë°”ë¥¸ íšŒì°¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”');
    return;
  }

  const sortedNums=[...nums].sort((a,b)=>a-b);

  if(editId){
    // ìˆ˜ì •
    const idx=myPredictions.findIndex(p=>p.id===editId);
    if(idx>=0){
      myPredictions[idx].targetRound=round;
      myPredictions[idx].numbers=sortedNums;
      myPredictions[idx].memo=memo;
      myPredictions[idx].status='pending';
      myPredictions[idx].result=null;
    }
  }else{
    // ì¶”ê°€
    myPredictions.push({
      id:Date.now().toString(),
      createdAt:new Date().toISOString(),
      targetRound:round,
      numbers:sortedNums,
      memo:memo,
      status:'pending',
      result:null
    });
  }

  saveMyPredictions();
  updatePredictionResults();
  renderMyPredictions();
  closePredictModal();

  // ë‚´ ì˜ˆì¸¡ íƒ­ìœ¼ë¡œ ì´ë™
  showSection('mypredict',document.querySelector('.nav-item:nth-child(3)'));
}

function editPrediction(id){
  const p=myPredictions.find(x=>x.id===id);
  if(!p)return;
  document.getElementById('predictEditId').value=id;
  document.getElementById('predictRoundInput').value=p.targetRound;
  document.getElementById('predictNumbersInput').value=p.numbers.join(', ');
  document.getElementById('predictMemoInput').value=p.memo||'';
  document.getElementById('predictModalTitle').textContent='ì˜ˆì¸¡ ìˆ˜ì •';
  document.getElementById('predictModal').classList.add('active');
}

function deletePrediction(id){
  if(!confirm('ì´ ì˜ˆì¸¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?'))return;
  myPredictions=myPredictions.filter(p=>p.id!==id);
  saveMyPredictions();
  renderMyPredictions();
}

// ëª¨ë‹¬ ë‹«ê¸°
document.getElementById('predictModal').onclick=function(e){if(e.target===this)closePredictModal()};

init();
</script>
</body>
</html>
